<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Kildomaten – Dapla-manualen</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../statistikkere/altinn-dapla-suv-tools.html" rel="next">
<link href="../statistikkere/vardef-model.html" rel="prev">
<link href="../images/dapla-favicon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-aa65cd192e579b25f59b24f35894e2e1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Ingen resultater",
    "search-matching-documents-text": "treff",
    "search-copy-link-title": "Kopier link til søk",
    "search-hide-matches-text": "Skjul flere treff",
    "search-more-match-text": "flere treff i dokumentet",
    "search-more-matches-text": "flere treff i dokumentet",
    "search-clear-button-title": "Nullstill",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Send",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Kildomaten – Dapla-manualen">
<meta property="og:description" content="">
<meta property="og:image" content="https://manual.dapla.ssb.no/images/checks_passed.png">
<meta property="og:site_name" content="Dapla-manualen">
<meta property="og:image:alt" content="Suksessfulle tester på GitHub">
<meta property="og:image:height" content="671">
<meta property="og:image:width" content="1979">
<meta name="twitter:title" content="Kildomaten – Dapla-manualen">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://manual.dapla.ssb.no/images/checks_passed.png">
<meta name="twitter:image:alt" content="Suksessfulle tester på GitHub">
<meta name="twitter:image-height" content="671">
<meta name="twitter:image-width" content="1979">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/dapla-long.png" alt="Logo for Dapla" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Dapla-manualen</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../statistikkere/index.html" aria-current="page"> 
<span class="menu-text">Manual</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../utviklere/lenker.html"> 
<span class="menu-text">Utviklere</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../news/index.html"> 
<span class="menu-text">Nyheter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog/index.html"> 
<span class="menu-text">Blogg</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../notebooks/index.html"> 
<span class="menu-text">Eksempler</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../om-dapla.html"> 
<span class="menu-text">Om Dapla</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hjelp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hjelp</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hjelp">    
        <li>
    <a class="dropdown-item" href="https://dapla-ctrl.intern.ssb.no/"><i class="bi bi-people-fill" role="img">
</i> 
 <span class="dropdown-text">Dapla Ctrl</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://web.yammer.com/main/org/ssb.no/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiI5MDUzMjA2In0/all"><i class="bi bi-people-fill" role="img">
</i> 
 <span class="dropdown-text">Diskusjonsforum</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ssb.pureservice.com/#/new/7"><i class="bi bi-send-fill" role="img">
</i> 
 <span class="dropdown-text">Kundeservice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../faq.html"><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="dropdown-text">FAQ</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-logg-inn" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person-circle" role="img">
</i> 
 <span class="menu-text">Logg inn</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-logg-inn">    
        <li>
    <a class="dropdown-item" href="https://lab.dapla.ssb.no/"><i class="bi bi-graph-up" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (prod)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://lab.dapla-test.ssb.no/"><i class="bi bi-graph-up-arrow" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (test)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://lab.dapla-dev.ssb.no/"><i class="bi bi-graph-up-arrow" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (dev)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jupyter.dapla.ssb.no/"><i class="bi bi-journal-code" role="img">
</i> 
 <span class="dropdown-text">JupyterLab (prod)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jupyter.dapla-staging.ssb.no/"><i class="bi bi-journal-code" role="img">
</i> 
 <span class="dropdown-text">JupyterLab (staging)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://console.cloud.google.com/"><i class="bi bi-google" role="img">
</i> 
 <span class="dropdown-text">Google Cloud Console</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://datahub.external.staging.ssb.cloud.nais.io/explore"><i class="bi bi-database-fill" role="img">
</i> 
 <span class="dropdown-text">DaplaHub (POC)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://dapla-ctrl.intern.ssb.no/"><i class="bi bi-controller" role="img">
</i> 
 <span class="dropdown-text">Dapla Ctrl</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/statisticsnorway/dapla-manual"> <i class="bi bi-github" role="img" aria-label="Dapla-manual GitHub repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../statistikkere/kildomaten.html">Datatjenester</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kom i gang</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hurtigstart</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/dapla-overgang.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hvordan flytte statistikkproduksjon til Dapla?</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/hva-er-dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dapla-team</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/hva-er-dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er Dapla-team?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/tilgangsstyring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tilgangsstyring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/administrasjon-av-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Administrasjon av team</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/jobbe-med-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/jobbe-med-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jobbe med data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/hva-er-botter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er bøtter?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/deling-av-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Deling av data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/git-og-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kode</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/git-og-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git og GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/ssb-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SSB-project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/poetry-ssb-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pakkehåndtering i Python</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/renv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pakkehåndtering i R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/standarder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standarder</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/standarder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standarder</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/datatilstander.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datatilstander</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/navnestandard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Navnestandard</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/kvakk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kvalitet i kode og koding (KVAKK)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/dapla-lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dapla Lab</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/datadoc-editor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datadoc-editor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/jdemetra.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jdemetra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/jupyter-playground.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter-playground</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/jupyter-pyspark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jupyter-pyspark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/rstudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rstudio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/vardef-forvaltning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vardef-forvaltning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/vscode-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vscode-python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/datadoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datadoc</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/datadoc-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datamodell</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/klass.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Klass</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/vardef.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vardef</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/vardef-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datamodell</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/kildomaten.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Datatjenester</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/altinn-dapla-suv-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dapla-suv-tools</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/kildomaten.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Kildomaten</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/dapla-auth-client.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dapla-auth-client</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/dapla-ctrl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dapla Ctrl</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/dapla-pseudo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dapla-toolbelt-pseudo</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/dapla-toolbelt-metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dapla-toolbelt-metadata</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/datadoc-toolbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datadoc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/vardef-toolbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vardef</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/standards-toolbelt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standards</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/maskinporten-guardian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maskinporten Guardian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/dapla-statbank-client.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dapla-statbank-client</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/data-collector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data-Collector</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/transfer-service.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transfer Service</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/metodebibliotek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metodebiblioteket</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/gcc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Google Cloud Console (GCC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/ssb-altinn-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ssb-altinn-python</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/altinn-oversikt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Altinn 3</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/altinn-oversikt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Oversikt</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/altinn-bygge-prefill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefill</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/altinn-skjema-administrasjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Administrasjon av skjema</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/altinn-sfu.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SFU</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../statistikkere/appendix/dashboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/contribution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hvordan bidra til Dapla-manualen</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/arkivering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Arkivering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/dashboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dash og dashboard</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/innlogging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Innlogging</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/jit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Just-in-Time Access</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Apache Spark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/kartdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kartdata</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/filinnsamling-moveit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Filinnsamling via MoveIT</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../statistikkere/appendix/langtkjorende-jobber.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kjøre tidkrevende jobber på Dapla</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#forberedelser" id="toc-forberedelser" class="nav-link active" data-scroll-target="#forberedelser">Forberedelser</a></li>
  <li><a href="#sette-opp-tjenesten" id="toc-sette-opp-tjenesten" class="nav-link" data-scroll-target="#sette-opp-tjenesten">Sette opp tjenesten</a>
  <ul class="collapse">
  <li><a href="#klone-iac-repoet" id="toc-klone-iac-repoet" class="nav-link" data-scroll-target="#klone-iac-repoet">Klone IaC-repoet</a></li>
  <li><a href="#mappestruktur-i-iac-repo" id="toc-mappestruktur-i-iac-repo" class="nav-link" data-scroll-target="#mappestruktur-i-iac-repo">Mappestruktur i IaC-repo</a></li>
  <li><a href="#flere-kilder" id="toc-flere-kilder" class="nav-link" data-scroll-target="#flere-kilder">Flere kilder</a></li>
  <li><a href="#konfigurasjon-og-skript" id="toc-konfigurasjon-og-skript" class="nav-link" data-scroll-target="#konfigurasjon-og-skript">Konfigurasjon og skript</a></li>
  <li><a href="#test-koden" id="toc-test-koden" class="nav-link" data-scroll-target="#test-koden">Test koden</a></li>
  <li><a href="#rull-ut-tjenesten" id="toc-rull-ut-tjenesten" class="nav-link" data-scroll-target="#rull-ut-tjenesten">Rull ut tjenesten</a></li>
  <li><a href="#test-tjenesten" id="toc-test-tjenesten" class="nav-link" data-scroll-target="#test-tjenesten">Test tjenesten</a></li>
  <li><a href="#monitorering-og-logging" id="toc-monitorering-og-logging" class="nav-link" data-scroll-target="#monitorering-og-logging">Monitorering og logging</a></li>
  <li><a href="#skalering" id="toc-skalering" class="nav-link" data-scroll-target="#skalering">Skalering</a></li>
  <li><a href="#varsling-på-e-post" id="toc-varsling-på-e-post" class="nav-link" data-scroll-target="#varsling-på-e-post">Varsling på e-post</a></li>
  <li><a href="#flere-kilder-1" id="toc-flere-kilder-1" class="nav-link" data-scroll-target="#flere-kilder-1">Flere kilder</a></li>
  <li><a href="#test-miljø" id="toc-test-miljø" class="nav-link" data-scroll-target="#test-miljø">Test-miljø</a></li>
  <li><a href="#trigge-kilde-manuelt" id="toc-trigge-kilde-manuelt" class="nav-link" data-scroll-target="#trigge-kilde-manuelt">Trigge kilde manuelt</a></li>
  </ul></li>
  <li><a href="#vedlikehold" id="toc-vedlikehold" class="nav-link" data-scroll-target="#vedlikehold">Vedlikehold</a>
  <ul class="collapse">
  <li><a href="#endre-skript" id="toc-endre-skript" class="nav-link" data-scroll-target="#endre-skript">Endre skript</a></li>
  <li><a href="#endre-config.yaml" id="toc-endre-config.yaml" class="nav-link" data-scroll-target="#endre-config.yaml">Endre config.yaml</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/statisticsnorway/dapla-manual/edit/main/dapla-manual/statistikkere/kildomaten.qmd" class="toc-action"><i class="bi bi-github"></i>Rediger siden</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/issues/new" class="toc-action"><i class="bi empty"></i>Rapporter feil</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/blob/main/dapla-manual/statistikkere/kildomaten.qmd" class="toc-action"><i class="bi empty"></i>Vis kilde</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Kildomaten</h1>
</div>



<div class="quarto-title-meta">

    
  
    <div>
    <div class="quarto-title-meta-heading">Sist endret</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 16, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<p>Kildomaten er en tjeneste for å automatisere overgangen fra <a href="./datatilstander.html#kildedata">kildedata</a> til <a href="./datatilstander.html#inndata">inndata</a>.</p>
<p>Tjenesten lar statistikkere kjøre sine egne skript automatisk på alle nye filer i kildedatabøtta og skrive resultatet til produktbøtta. Formålet med tjenesten er minimere behovet for tilgang til kildedata samtidig som teamet selv bestemmer hvordan transformasjonn til inndata skal foregå. Statistikkproduksjon kan da starte i en tilstand der dataminimering og pseudonymisering allerede er gjennomført.</p>
<p>Prosessering som skal skje i overgangen fra kildedata til inndata har SSB definert til å være:</p>
<ul>
<li><strong>Dataminimering</strong>:<br>
Fjerne alle felter som ikke er strengt nødvendig for å produsere statistikk.</li>
<li><strong>Pseudonymisering</strong>:<br>
Pseudonymisering av personidentifiserende data.</li>
<li><strong>Kodeverk</strong>:<br>
Legge på standard kodeverk fra for eksempel <a href="https://www.ssb.no/klass/">Klass</a>.<br>
</li>
<li><strong>Standardisering</strong>:<br>
Tegnsett, datoformat, etc. endres til SSBs standardformat.</li>
</ul>
<p>En forutestning for å bruke kildomaten er å ha et <a href="../statistikkere/hva-er-dapla-team.html">Dapla-team</a>.</p>
<section id="forberedelser" class="level2">
<h2 class="anchored" data-anchor-id="forberedelser">Forberedelser</h2>
<p>Før et Dapla-team kan ta i bruk kildomaten må tjenesten være aktivert for teamet. Som standard får alle statistikkteam dette skrudd på i <strong>prod</strong>-miljøet som opprettes for teamet. Ønsker du å aktivere kildomaten i <strong>test</strong>-miljøet kan dette gjøres selvbetjent som en <a href="./features.html">feature</a>. Alternativt kan man opprette en <a href="https://ssb.pureservice.com/#/categories/14/new">Kundeservice</a>-sak og be om å hjelp til dette.</p>
</section>
<section id="sette-opp-tjenesten" class="level2">
<h2 class="anchored" data-anchor-id="sette-opp-tjenesten">Sette opp tjenesten</h2>
<p>I denne delen bryter vi ned prosessen med å sette opp kildomaten i de stegene vi mener er hensiktsmessige. Senere i artikkelen forklarer vi hvordan man setter den opp flere kilder og hvordan man vedlikeholder tjenesten.</p>
<p>Husk at alle på teamet kan gjøre det meste av arbeidet her, men det er <strong>data-admins</strong> som må godkjenne at <a href="./kildomaten.html#rull-ut-tjenesten">tjenesten rulles ut</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<section id="klone-iac-repoet" class="level3">
<h3 class="anchored" data-anchor-id="klone-iac-repoet">Klone IaC-repoet</h3>
<p>Oppsett av kildomaten gjøres i teamets IaC-repo<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Når vi skal sette opp kildomaten må vi gjøre endringer i teamets IaC-repo. Man finner teamets IaC-repo ved gå inn på <a href="https://github.com/statisticsnorway">SSBs GitHub-organisasjon</a> og søke etter repoet som heter <code>&lt;teamnavn&gt;-iac</code>. Når du har funnet repoet så kan du gjøre følgende:</p>
<ol type="1">
<li>Klon ned ditt teams Iac-repo <code>git clone &lt;repo-url&gt;</code></li>
<li>Opprett en ny branch: <code>git switch -c add-kildomaten-source</code></li>
</ol>
</section>
<section id="mappestruktur-i-iac-repo" class="level3">
<h3 class="anchored" data-anchor-id="mappestruktur-i-iac-repo">Mappestruktur i IaC-repo</h3>
<p>For at kildomaten skal fungere må det opprettes en bestemt mappestruktur i IaC-repoet til teamet. Når et team blir opprettet vil den grunnleggende mappestrukturen i IaC-repoet allerede være opprettet for <strong>prod</strong>-miljøet til teamet. F.eks. vil mappestrukturen se slik ut for team <strong>dapla-example</strong>:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">│           └── README.md</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">│ </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Skal du sette opp kildomaten i prod-miljøet kan du følge oppskriften som kommer senere i kapitlet uten å gjøre noe mer enda.</p>
<p>Skal du også bruke kildomaten i <strong>test</strong>-miljøet må du opprette en ny mappe og lage en PR i IaC-repoet til teamet. Da vil strukturen se slik ut:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── README.md</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-test/ </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I mappestrukturen over har vi klargjort den grunnleggende mappestrukturen for å ta i bruk kildomaten i prod- og test-miljøet. Neste steg blir å legge de ulike kildene som egne mapper under <code>dapla-example-prod</code> og <code>dapla-example-test</code>. Det viser vi i neste avsnitt.</p>
</section>
<section id="flere-kilder" class="level3">
<h3 class="anchored" data-anchor-id="flere-kilder">Flere kilder</h3>
<p>Kildomaten lar deg prosessere ulike filstier i kildebøtta med ulike python-script. Dette refereres til som at Kildomaten har flere <em>kilder</em>. For å sette opp en kilde må man følge en definert mappestruktur i IaC-repoet der alle kildene ligger rett under <code>&lt;teamnavn&gt;-prod</code>- eller <code>&lt;teamnavn&gt;-test</code>-mappen. Du kan ikke ha undermapper under en kilde. Du velger selv navnet på kildene/mappene i IaC-repoet, og det vil være navnet på kildene i Kildomaten. Senere i kapitlet ser vi at vi må bruke navnet for trigge re-kjøring av kilder.</p>
<p>Under er et eksempel på hvordan det kan se ut for eksempel-teamet dapla-example:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── altinn</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── ameld</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-test/</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── altinn</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── ameld</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">│       │    └── nudb</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I eksempelet over ser vi at det er mapper i IaC-repoet for kildene <em>altinn</em> og <em>ameld</em> for både test- og prod-miljøet. I tillegg har test-miljøet en mappe for kilden <em>nudb</em>. Hver av disse kildene kan kjøre et eget Pyton-script på alle filer som skrives til en gitt filsti som man definerer selv.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Alle kilder på samme nivå
</div>
</div>
<div class="callout-body-container callout-body">
<p>Et team kan sette opp forskjellige skript for forkskjellige kilder men kildomaten tillater bare ett nivå under <code>automation/source-data-&lt;teamnavn&gt;-&lt;miljø&gt;/</code>. Det vil si at du ikke kan ha undermapper under en kilde. Det er også slik at man alltid må opprette en mappe for en kilde, selv om du kun har en kilde. F.eks. kan man ikke droppe mappen <code>altinn</code> i eksempelet over.</p>
</div>
</div>
</section>
<section id="konfigurasjon-og-skript" class="level3">
<h3 class="anchored" data-anchor-id="konfigurasjon-og-skript">Konfigurasjon og skript</h3>
<p>Når mappestrukturen er opprettet kan man legge til konfigurasjonsfilen som beskriver hvilke filer som skal prosesseres, og python-skriptet med koden som skal prosessere filene. Det er to filer for hver datakilde:</p>
<ol type="1">
<li>En konfigurasjonsfil</li>
<li>Et Python-skript</li>
</ol>
<p>Her ser du hvordan IaC-repoet ser ut med én kilde (altinn):</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">│           └── altinn/</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">│               ├── config.yaml</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">│               └── process_source_data.py</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="konfigurasjonsfil" class="level4">
<h4 class="anchored" data-anchor-id="konfigurasjonsfil">Konfigurasjonsfil</h4>
<p>Kildomaten trigges ved at det oppstår nye filer i kildebøtta til teamet. Hvorvidt den skal trigges på alle filer, eller kun filer i en gitt undermappe, bestemmer brukeren ved å konfigurere tjenesten i <code>config.yaml</code>. Her kan du også angi hvor mye ressurser prosesseringen skal få.</p>
<p>Hvis vi fortsetter eksempelet vårt fra tidligere med <code>dapla-example</code> kan vi tenke oss at teamet ønsker at kildomaten skal trigges på alle filer som oppstår i kildebøtta under filstien:<br>
<code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/</code>.</p>
<p>For å konfigurere tjenesten i kildomaten må vi legge til en fil som heter <code>config.yaml</code> under <code>automation/source-data/dapla-example-prod/altinn/</code> slik som vist tidligere. I dette tilfellet vil den ha innholdet som vist til venstre under:</p>
<div class="columns">
<div class="column" style="width:47.5%;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>config.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="config.yaml"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">folder_prefix</span><span class="kw">:</span><span class="at"> ledstill/altinn</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">memory_size</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">  # GiB</span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:5%;">
<!-- empty column to create gap -->
</div><div class="column" style="width:47.5%;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ssb-dapla-example-data-kilde-prod/</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="ssb-dapla-example-data-kilde-prod/"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="at">├── ledstill/</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── altinn/</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── aordningen/</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">├── sykefra/</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── altinn/</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── freg/</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">│...</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">       </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Mappestrukturen i kildebøtta er illustrert til høyre, mens <code>config.yaml</code>-fila til venstre viser hvordan vi angir at kildomaten kun skal trigges på nye filer som oppstår i undermappen <code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/</code>. Vi bruker nøkkelen <code>folder_prefix</code> for å angi hvilken sti i kildebøtta som tjenesten skal trigges på. Nøkkelen <code>memory_size</code> lar brukeren angi hvor mye minne og CPU hver prosessering skal få. Vil du at alle filer skal trigge kildomaten? Da setter du <code>folder_prefix</code> til <code>""</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hvor mye minne og CPU er mulig?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Som standard får hver prosessering med kildomaten 1 CPU-kjerne og 512MB minne/RAM. Hvis man skal gjøre mye prossesering, eller filene som prosesseres er veldig store, kan man sette <code>memory_size</code> opp til max 32GB minne. Antall CPU-kjerner blir satt implisitt ut i fra valg av <code>memory_size</code> iht til <a href="https://cloud.google.com/run/docs/configuring/services/memory-limits#cpu-minimum">begrensningene som Google setter for Cloud Run</a>. Se de <a href="https://github.com/statisticsnorway/terraform-dapla-source-data-processor/blob/b7655776258c79a91e97dd0da4c5c1e6f3631796/modules/processor-instance/locals.tf#L2">nøyaktige verdiene</a> som blir satt her.</p>
</div>
</div>
</div>
</section>
<section id="python-skript" class="level4">
<h4 class="anchored" data-anchor-id="python-skript">Python-skript</h4>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Husk dette når du skriver skriptet ditt
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Skriptet ditt kommer til å bli kjørt på en-og-en fil.</li>
<li>Skriptet ditt må skrive ut et unikt navn på filen som skal skrives til produktbøtta, ellers risikerer du at filer blir overskrevet.</li>
<li>Python-pakkene som kan benyttes <a href="https://github.com/statisticsnorway/dapla-source-data-processor/blob/main/pyproject.toml">er definert her</a>. Ved behov for andre pakker, <a href="https://ssb.pureservice.com/#/categories/14/new">ta kontakt med Kundeservice</a>.<br>
</li>
</ol>
</div>
</div>
<p>Python-skriptet er der teamet angir hva slags kode som skal kjøre på hver fil som dukker opp i den angitte mappen i kildebøtta. For at dette skal være mulig må koden følge disse reglene:</p>
<ol type="1">
<li>Koden må ligge i en fil som heter <code>process_source_data.py</code>.</li>
<li>Koden må pakkes inn i en funksjon som heter <code>main()</code>.</li>
</ol>
<p><code>main()</code> er en funksjon med ett parameter som heter <code>source_file</code> som du alltid får av kildomaten når en fil blir prosessert. Når man skriver koden kan man derfor anta at dette parameteret blir gitt til funksjonen, og du kan benytte det inne i <code>main</code>-funksjonen.</p>
<p><code>source_file</code>-parameteret gir <code>main()</code> en ferdig definert filsti til filen som skal prosesseres. For eksempel kan <code>source_file</code> ha verdien<br>
<code>gs://ssb-dapla-example-data-kilde-prod/ledstill/altinn/test20231010.csv</code> hvis filen <code>test20231010.csv</code> dukker opp i <code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/</code>.</p>
<p>Hvis vi fortsetter eksempelet fra tidligere ser mappen i IaC-repoet vårt slik ut nå:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">│           └── altinn/</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="at">│               ├── config.yaml</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="at">│               └── process_source_data.py</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="at">│</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="at">│...         </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vi ser nå at filene <code>config.yaml</code> og <code>process_source_data.py</code> ligger i mappen<br>
<code>automation/source-data/dapla-example-prod/ledstill/altinn/</code>. Senere, når vi har rullet ut tjenesten, vil en ny fil i <code>gs://ssb-dapla-exmaple-data-kilde-prod/ledstill/altinn/</code> trigge kildomaten og kjøre koden i <code>process_source_data.py</code> på filen.</p>
<p>Under ser du et eksempel på hvordan en vanlig kodesnutt kan konverteres til å kjøre i kildomaten:</p>
<div class="columns">
<div class="column" style="width:47%;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Vanlig kode</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Vanlig kode"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Stien til filen</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>source_file <span class="op">=</span> <span class="st">"gs://ssb-dapla-example-data-kilde-prod/ledstill/altinn/test20231010.csv"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(source_file)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataminimerer ved å velge kolonner</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df[[<span class="st">'col1'</span>, <span class="st">'col2'</span>, <span class="st">'col3'</span>]]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Skriver ut fil til produktbøtta</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>dp.write_pandas(df2, </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"gs://ssb-dapla-example-data-produkt-prod/test20231010.parquet"</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:6%;">

</div><div class="column" style="width:47%;">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Kode i Kildomaten</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Kode i Kildomaten"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(source_file):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(source_file)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataminimerer ved å velge kolonner</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> df[[<span class="st">'col1'</span>, <span class="st">'col2'</span>, <span class="st">'col3'</span>]]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Bytter ut "kilde" med "produkt" i filstien</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    new_path <span class="op">=</span> source_file.replace(<span class="st">"kilde"</span>, <span class="st">"produkt"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Bytter ut ".csv" med ".parquet" i filstien</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    new_path2 <span class="op">=</span> new_path.replace(<span class="st">".csv"</span>, <span class="st">".parquet"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Skriver ut fil til produktbøtta</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    dp.write_pandas(df2, new_path2)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>De to kodesnuttene over gir det samme resultatet, bare at koden til venstre kjøres som vanlig python-kode, mens koden til høyre kjøres i kildomaten. Som vi ser av koden til høyre så trenger vi aldri å hardkode inn filstier i kildomaten. Tjenesten gir oss filstien, og vi kan bruke den til å skrive ut filen til produktbøtta.</p>
<p>Strukturen på filene som skrives bør tenkes nøye gjennom når man automatiseres prosessering av data. Hvis vi ikke har unike filnavn eller stier kan du risikere at filer blir overskrevet. Typisk er dette allerede tenkt på når filer skrives til kildebøtta, så hvis man kopierer den strukturen, slik vi gjorde i eksempelet over, så vil det ikke være noe problem.</p>
</section>
</section>
<section id="test-koden" class="level3">
<h3 class="anchored" data-anchor-id="test-koden">Test koden</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tilgang til kildedata
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tilgang til kildedata i prod-miljøet er det kun gruppen <strong>data-admins</strong> som kan aktivere ved å bruke tilgangsstyringsløsningen <a href="https://jitaccess.dapla.ssb.no/">Just-in-Time Access (JIT)</a>. Les mer om hvordan <a href="./jit.html">JIT-løsningen fungerer her</a>. Ønsker man å kunne liste ut innhold fra bøtta må man aktivere rollen <code>ssb.buckets.list</code>. Ønsker man i tillegg å lese/skrive til bøtta må man også aktivere <code>ssb.bucket.write</code>. Tilgang til kildebøtta i test-miljøet krever ikke JIT-tilgang.</p>
</div>
</div>
<p>Før man ruller ut koden i tjenesten er det greit å teste at alt fungerer som det skal i Jupyterlab. Hvis vi tar utgangspunkt i eksempelet over kan vi teste koden ved å kjøre følgende nederst i skriptet:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>process_source_data.py</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="process_source_data.py"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>main(<span class="st">"gs://ssb-dapla-example-data-kilde-prod/ledstill/altinn/test20231010.csv"</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Når tjenesten er rullet ut vil det være dette som kjøres når en fil dukker opp i <code>gs://ssb-dapla-example-data-kilde-prod/ledstill/altinn/</code>. Ved å kjøre det manuelt på denne måten får vi sett at ting fungerer som det skal.</p>
<p>Husk å fjerne kjøringen av koden før du ruller ut tjenesten.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pseudonymisering kan <strong>ikke</strong> kjøres fra en IDE i prod-miljøet
</div>
</div>
<div class="callout-body-container callout-body">
<p>Du kan teste kode fra Jupyter og andre IDE-er i prod-miljøet på Dapla med mindre prosesseringen innebærer bruk av pseudonymisering. Grunnen til dette er at det ikke er ønskelig å gjøre det lett å se upseudonymisert og pseudonymisert data samtidig. Hvis man ønsker å teste prosesseringen av pseudo-tjenesten kan man gjøre med testdata i test-miljøet.</p>
</div>
</div>
</section>
<section id="rull-ut-tjenesten" class="level3">
<h3 class="anchored" data-anchor-id="rull-ut-tjenesten">Rull ut tjenesten</h3>
<p>For å rulle ut tjenesten gjør du følgende;</p>
<ol type="1">
<li><em>Push branchen</em> til GitHub og opprette en <em>pull request</em>.</li>
<li><em>Pull request</em> må godkjennes av en <strong>data-admins</strong> på teamet.</li>
</ol>
<div class="grid">
<div class="g-col-4">
<ol start="3" type="1">
<li>Når <em>pull request</em> er godkjent så sjekker du om alle tester, planer og utrullinger var vellykket, slik som vist i <a href="#fig-passing-checks" class="quarto-xref">Figur&nbsp;1</a>.</li>
<li>Hvis alt er vellykket så kan du <em>merge</em> branchen inn i <code>main</code>-branchen.</li>
</ol>
</div>
<div class="g-col-8">
<div id="fig-passing-checks" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Suksessfulle tester på GitHub">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-passing-checks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="../images/checks_passed.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figur&nbsp;1: Suksessfulle tester på GitHub"><img src="../images/checks_passed.png" class="img-fluid figure-img" alt="Suksessfulle tester på GitHub"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-passing-checks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;1: Suksessfulle tester på GitHub
</figcaption>
</figure>
</div>
</div>
</div>
<p>Etter at du har <em>merget</em> inn i <em>main</em> kan du følge med på utrullingen under <em>Actions</em>-fanen i repoet. Når den siste jobben lyser grønt er kildomaten rullet ut og klar til bruk.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vanlige feil ved utrulling
</div>
</div>
<div class="callout-body-container callout-body">
<p>For å gi raskt tilbakemelding på noen mulige feilsituasjoner kjøres det enkel validering på <code>config.yaml</code> og <code>process_source_data.py</code> når en <em>Pull request</em> er opprettet. Følgende validering gjennomføres:</p>
<ul>
<li>Heter python-skriptet <code>process_source_data.py</code>?</li>
<li>Finnes en <code>config.yaml</code> med gyldig <code>folder_prefix:</code>?</li>
<li>Bruker <code>process_source_data.py</code> biblioteker som ikke <a href="https://github.com/statisticsnorway/dapla-source-data-processor/blob/main/pyproject.toml">er installert i kildomaten</a>?</li>
<li>Har koden i <code>process_source_data.py</code> feil iht <a href="https://pypi.org/project/pyflakes/">Pyflakes</a>?</li>
</ul>
<p>Det kan også forekomme at <strong>Atlantis</strong>, verktøyet for å rulle ut endringer fra IaC-repoet til GCP, feiler. Da kan du prøve å skrive <code>atlantis plan</code> i kommentarfeltet til <em>pull request</em>’en, og testene vil kjøre på nytt. Hvis det fortsatt ikke fungerer kontakter man Dapla kundeservice.</p>
</div>
</div>
</section>
<section id="test-tjenesten" class="level3">
<h3 class="anchored" data-anchor-id="test-tjenesten">Test tjenesten</h3>
<p>Når du har rullet ut tjenesten kan du <em>teste</em> tjenesten ved at <strong>data-admins</strong> flytter en fil til en den filstien kildomaten er satt opp for. I eksempelet vi har brukt tidligere, gjør du følgende: 1. Aktiverer JIT-tilgangen til kildedata (som beskrevet over). 2. Kopier en fil over til filstien:<br>
<code>gs://ssb-dapla-example-data-kilde-prod/ledstill/altinn/</code> 3. Sjekk om filen ble skrevet til ønsket mappe i produktbøtta.</p>
<p>Du kan også sjekke logger og monitorere kildomaten.</p>
</section>
<section id="monitorering-og-logging" class="level3">
<h3 class="anchored" data-anchor-id="monitorering-og-logging">Monitorering og logging</h3>
<p>Når en kilde i kildomaten er satt opp og ruller ut kan tjenesten monitoreres i Google Cloud Console (GCC) ved å gjøre følgende:</p>
<ol type="1">
<li><a href="https://console.cloud.google.com/">Logg deg inn</a> med SSB-bruker på GCC.</li>
<li>Velg standardprosjektet i prosjektvelgeren<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</li>
<li>Søk opp <strong>Cloud Run</strong> i søkefeltet på toppen av siden og gå inn på siden.</li>
</ol>
<p>På siden til <strong>Cloud Run</strong> vil du se en oversikt over alle kilder teamet har kjørende i kildomaten. De har formen <code>source-&lt;kildenavn&gt;-processor</code>. I eksempelet med team <strong>dapla-example</strong> tidligere, vil man da se en kilde som heter <code>source-altinn-processor</code>, siden mappen de opprettet under<br>
<code>automation/source-data-dapla-example-prod/</code> i IaC-repoet heter <code>altinn</code>.</p>
<p>Trykker man seg inn på hver enkelt kilde vil man kunne monitorere aktiviteten i kilden, og man kan trykke seg videre for å se loggene.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sjekke logger
</div>
</div>
<div class="callout-body-container callout-body">
<p>Det er anbefalt å se på Kildomaten-loggene i Logs Explorer. Det kan man enkelt gjøre ved å trykke på “View in Logs Explorer” som vist på bildet under:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="../images/kildomaten-logger.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Åpne Kildomaten-loggene i Logs Explorer"><img src="../images/kildomaten-logger.png" class="img-fluid figure-img" style="width:100.0%" alt="Bilde som viser hvordan man åpner Logs Explorer"></a></p>
<figcaption>Åpne Kildomaten-loggene i Logs Explorer</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="skalering" class="level3">
<h3 class="anchored" data-anchor-id="skalering">Skalering</h3>
<p>Kildomaten er satt opp for å kunne prosessere hver kilde i 100 parallelle instanser samtidig. F.eks. hvis det oppstår 110 nye filer i en mappe som trigger en kildomaten-kilde, kan det prosesseres 100 filer samtidig. <a href="https://ssb.pureservice.com/#/categories/14/new">Ta kontakt med Kundeservice</a> hvis man har behov for ytterlige skalering.</p>
</section>
<section id="varsling-på-e-post" class="level3">
<h3 class="anchored" data-anchor-id="varsling-på-e-post">Varsling på e-post</h3>
<p>Kildomaten tilbyr e-postvarsling til teamet når tjenesten feiler. Opprett en Kundeservice-sak for å få satt opp e-postvarsling for teamet ditt.</p>
</section>
<section id="flere-kilder-1" class="level3">
<h3 class="anchored" data-anchor-id="flere-kilder-1">Flere kilder</h3>
<p>Man kan sette opp så mange kilder man ønsker. Men når man setter det opp er det viktig å huske at alle kildene må spesifiseres rett under <code>automation/source-data/&lt;teamnavn&gt;-&lt;miljø&gt;/</code>. Her er et eksempel på hvordan team <strong>dapla-example</strong> har to kilder i kildomaten:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="at">│           └── altinn/</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">│               ├── config.yaml</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="at">│               └── process_source_data.py</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="at">│           └── ledstill/</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="at">│               ├── config.yaml</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="at">│               └── process_source_data.py</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I eksempelet over ser vi det er to kilder: <code>altinn</code> og <code>ledstill</code>. Hver kilde trigges på ulike filstier i kildebøtta, og python-koden som kjøres kan være ulik mellom kilder.</p>
</section>
<section id="test-miljø" class="level3">
<h3 class="anchored" data-anchor-id="test-miljø">Test-miljø</h3>
<p>I eksempelet som er brukt i denne artiklen er kildomaten satt opp i prodmiljøet til teamet. Man bør egentlig teste ut nye kilder i teamets test-miljø. Kildomaten er ikke satt opp i test-miljøet som standard, og derfor må det skrus på før man kan anvende det. Teamet kan gjøre det selv <a href="../statistikkere/features.html">ved å følge denne beskrivelsen</a> eller ta kontakt med kundeservice og få hjelp til dette.</p>
<p>En av de store fordelene med å sette opp kildomaten-kilder i test-miljøet før man gjør det i prod-miljøet er at tilgangsstyringen til data er mye mindre streng. Det gjør det lettere for alle i teamet å utvikle koden som skal benyttes.</p>
<p>Når man skal sette opp kildomaten i test-miljøet følger det samme oppskrift som vi har vist for prod-miljøet over. Den store forskjellen er at test-kilder skal legges under en egen mappe under <code>automation/source-data/</code> i teamets IaC-repo. Eksempelet under med team <strong>dapla-example</strong> viser hvordan man kan sette opp kildene <code>altinn</code> og <code>ledstill</code> for både prod- og test-testmiljøet:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>github.com/statisticsnorway/dapla-example-iac</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="github.com/statisticsnorway/dapla-example-iac"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="at">dapla-example-iac</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="at">├── automation/</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">│   └── source-data/</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-prod/</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="at">│       │       ├── altinn/</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="at">│       │       │       ├── config.yaml</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="at">│       │       │       └── process_source_data.py</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="at">│       │       └── ledstill/</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="at">│       │               ├── config.yaml</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="at">│       │               └── process_source_data.py</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="at">│       ├── dapla-example-test/</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="at">│               ├── altinn/</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="at">│               │       ├── config.yaml</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="at">│               │       └── process_source_data.py</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">│               └── ledstill/</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="at">│                       ├── config.yaml</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="at">│                       └── process_source_data.py</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="at">│...           </span></span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Som vi ser av mappestrukturen over er det to mapper under<br>
<code>automation/source-data</code>:</p>
<ul>
<li>dapla-example-prod</li>
<li>dapla-example-test</li>
</ul>
<p>Disse to mappene angir om det er henholdsvis prod- eller test-miljøet vi setter opp kilder for.</p>
</section>
<section id="trigge-kilde-manuelt" class="level3">
<h3 class="anchored" data-anchor-id="trigge-kilde-manuelt">Trigge kilde manuelt</h3>
<p>Kildomaten er bygget for å trigge på nye filer som oppstår i en gitt filsti. Men noen ganger er det nødvendig å trigge kjøring av filer for en gitt kilde på nytt. Dette kan gjøres med en funksjon i Python-pakken <a href="https://github.com/statisticsnorway/dapla-toolbelt">dapla-toolbelt</a>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Logg inn som data-admins i Dapla Lab
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trigging av kilder manuelt kan kun gjøres av <em>data-admins</em> på Dapla Lab. På Dapla Lab må man representere en av gruppene når man logger seg inn.</p>
</div>
</div>
<p>Før du kan gjøre dette trenger du følgende informasjon:</p>
<ol type="1">
<li><strong>project-id</strong> for <em>standardprosjektet</em>. <a href="../faq.html#hvordan-finner-jeg-et-google-prosjekt-sin-prosjekt-id">Slik finner du prosjekt-id</a>. Merk at dette ikke er kilde-prosjektet!</li>
<li><strong>folder_prefix</strong> er mappen i kilde-bøtten som du ønsker at koden skal trigges på. Dette fungerer likt som tidligere forklart for <code>config.yaml</code>, men her har du også mulighet til å kunne trigge prosesseringen på en undermappe av stien som var satt i kildens config.yaml.</li>
<li><strong>source_name</strong> er navnet på mappen i iac-repoet hvor kilden du skal trigge er definert. Navnet på kilden i eksempelet med team <strong>dapla-example</strong> var <code>altinn</code>.</li>
</ol>
<p>Hvis man under <strong>folder_prefix</strong> legger inn en hel filsti med filnavn og filending, så trigges Kildomaten kun på denne ene fila.</p>
<p>Her er et kodeeksempel som viser hvordan man kan trigge prossesering av alle filer for kilde</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>notebook</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="notebook"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> trigger_source_data_processing</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>project_id <span class="op">=</span> <span class="st">"dapla-example-p"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>source_name <span class="op">=</span> <span class="st">"altinn"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>folder_prefix <span class="op">=</span> <span class="st">"ledstill/altinn/ra0678"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>trigger_source_data_processing(project_id, source_name, folder_prefix, kuben<span class="op">=</span><span class="va">True</span>)          </span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I eksempelet over trigger vi scriptet som er satt opp for kilden <code>altinn</code> til å kjøre på alle undermapper av<br>
<code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/ra0678/</code>.</p>
<p>Her er et kodeeksempel som viser hvordan man kan trigge prosessering av spesifike filer i en kilde</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>notebook</strong></pre>
</div>
<div class="sourceCode" id="cb14" data-filename="notebook"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> trigger_source_data_processing</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>project_id <span class="op">=</span> <span class="st">"dapla-example-p"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>source_name <span class="op">=</span> <span class="st">"altinn"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>file_paths <span class="op">=</span> [</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ledstill/altin/ra0678/data1.parquet'</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ledstill/altin/ra0678/data2.parquet'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ledstill/altin/ra0678/data3.parquet'</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> file_paths:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    trigger_source_data_processing(project_id, source_name, <span class="bu">file</span>, kuben<span class="op">=</span><span class="va">True</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I eksempelet over trigger vi scriptet som er satt opp for kilden <code>altinn</code> til å kjøre på de tre spesifike filene <code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/ra0678/data1.parquet</code>, <code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/ra0678/data2.parquet</code> og <code>ssb-dapla-example-data-kilde-prod/ledstill/altinn/ra0678/data3.parquet</code>.</p>
</section>
</section>
<section id="vedlikehold" class="level2">
<h2 class="anchored" data-anchor-id="vedlikehold">Vedlikehold</h2>
<p>Når tjenesten er rullet ut så vil den kjøre automatisk på alle filer som dukker opp i filsti i kildebøtta. Etter hvert vil det være behov for å endre på skript, endre filstier som skal trigge tjenesten, eller prosessere alle filer på nytt. I denne delen forklarer vi hvordan du går frem for å gjøre dette.</p>
<section id="endre-skript" class="level3">
<h3 class="anchored" data-anchor-id="endre-skript">Endre skript</h3>
<p>Alle på team kan endre på skriptet, men det er <strong>data-admins</strong> som må godkjenne endringene før de blir rullet ut. For å endre skriptet gjør du følgende:</p>
<ol type="1">
<li>Klon repoet.</li>
<li>Gjør endringene du ønsker i en <em>branch</em>.</li>
<li>Push opp endringene til GitHub og opprett en <em>pull request</em>.</li>
<li>Få en data-admins på teamet til å godkjenne endringene.</li>
<li>Når endringene er godkjent så kan du <em>merge</em> inn i <code>main</code>-branchen.</li>
</ol>
<p>En endring i Python-skriptet krever ikke at tjenesten rulles ut på nytt. Derfor er det ikke like mange tester og kjøringer som gjøres som når man oppretter en helt ny kilde.</p>
</section>
<section id="endre-config.yaml" class="level3">
<h3 class="anchored" data-anchor-id="endre-config.yaml">Endre config.yaml</h3>
<p>Alle på teamet kan gjøre endringer i <code>config.yaml</code>, men det er <strong>data-admins</strong> som må godkjenne endringene før de blir rullet ut. For å endre <code>config.yaml</code> gjør du følgende:</p>
<ol type="1">
<li>Klon repoet.</li>
<li>Gjør endringene du ønsker i en <em>branch</em>.</li>
<li>Push opp endringene til GitHub og opprett en <em>pull request</em>.</li>
<li>Få en data-admins på teamet til å godkjenne endringene.</li>
<li>Når endringene er godkjent så kan du <em>merge</em> inn i <code>main</code>-branchen.</li>
</ol>
<p>En endring i config.yaml krever at tjenesten rulles ut på nytt og tar derfor litt mer tid enn en endring i Python-skriptet.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Fotnoter</h2>

<ol>
<li id="fn1"><p>I tillegg er det <strong>data-admins</strong> som må <a href="./kildomaten.html#test-koden">teste tjenesten</a> manuelt hvis det gjøres på skarpe data, siden det kun er data-admins som kan få tilgang til de dataene.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><em>Infrastructure-as-Code</em> (IaC) er repo som definerer alle ressursene til teamet på Dapla. Alle Dapla-team har et eget IaC-repo på GiHub med navnet <teamnavn>-iac under <a href="https://github.com/orgs/statisticsnorway/repositories">statisticsnorway</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></teamnavn></p></li>
<li id="fn3"><p>Standardprosjektet har navnestrukturen <code>&lt;teamnavn&gt;-p</code><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopiert!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopiert!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/manual\.dapla\.ssb\.no");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../statistikkere/vardef-model.html" class="pagination-link" aria-label="Datamodell">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Datamodell</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../statistikkere/altinn-dapla-suv-tools.html" class="pagination-link" aria-label="dapla-suv-tools">
        <span class="nav-page-text">dapla-suv-tools</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This site is heavily inspired by the <a href="https://quarto.org/">Quarto website</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>Kom i gang med Dapla</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/statisticsnorway/dapla-manual/edit/main/dapla-manual/statistikkere/kildomaten.qmd" class="toc-action"><i class="bi bi-github"></i>Rediger siden</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/issues/new" class="toc-action"><i class="bi empty"></i>Rapporter feil</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/blob/main/dapla-manual/statistikkere/kildomaten.qmd" class="toc-action"><i class="bi empty"></i>Vis kilde</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>