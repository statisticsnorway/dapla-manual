---
title: Delomaten
date-modified: 10/05/2025
lightbox: true
---

::: {.callout-warning}
## Tjenesten er under utvikling

Delomaten er under utvikling og er ikke tilgjengelig for Dapla-team enda. Tjenesten vil lanseres ila høsten 2025.
:::

Delomaten er en tjeneste som lar Dapla-team dele data med hverandre selv om de behandler personopplysninger ulikt. Tjenesten håndterer spesialtilfellene der team ikke kan bruke [standard delt-bøtter](./deling-av-data.qmd#typer-av-delt-bøtter) fordi teamet de skal dele med håndterer personopplysninger på en annen måte.

@fig-delomaten viser et eksempel på hvordan tjenesten fungerer når et team som jobber med pseudonymiserte personopplysninger skal dele data et med et team som skal se personopplysninger i klartekst. 


![Figuren viser hvordan hvordan team A deler de-pseudonymisert data med team B ved hjelp av Delomaten.](../images/delomaten.svg){#fig-delomaten}

Av @fig-delomaten ser vi at team A jobber med pseudonymiserte personopplysninger i sin produktbøtte. Disse dataene kan de dele med andre team via standard delt-bøtter som team A kan skrive til. Hvis de i tillegg ønsker å dele data i klartekst (de-pseudonymisert) så må de dele via en såkalt Delomaten delt-bøtte. Team A kan da bruke Delomaten til å de-pseudonymisere dataene og skrive til Delomaten delt-bøtta uten at de selv har tilgang til den bøtta, mens team B har tilgang. Da håndterer Delomaten de-pseudonymisering og skriving til bøtta basert på konfigurasjon som team A setter opp. 

Delomaten støtter også den motsatte flyten av det som er vist i @fig-delomaten. Dvs. hvis et team som håndterer personopplysninger i klartekst i produktbøtta ønsker å dele med et team som kun skal se opplysningene pseudonymisert. Re-pseudonymisering, dvs. bytte av krypteringsalgoritme eller nøkkel, støttes ikke av Delomaten enda. 

## Forberedelser

Før et team tar i bruk Delomaten, eller konsumerer data fra en Delomaten delt-bøtte, er det viktig at man setter seg godt inn i hvordan personvern i data håndteres i SSB. Ta kontakt med nærmeste leder eller Personvernombud dersom det er behov for rådgiving eller informasjon.

Under beskriver vi hvilke tekniske krav som gjelder for Delomaten.

### Dokumentasjon

Data som skal deles gjennom Delomaten-bøtter må være [dokumentert i Datadoc](./datadoc.qmd). Alle [obligatoriske felt](datadoc-model.qmd) i Datadoc må være utfylt og metadata-filen (.json) må ligge lagret med riktig navn ved siden av data-filen. Delomaten-jobbene vil feile dersom metadatafilen ikke finnes.

::: {.callout-important}
## Metadata om pseudonymisering

For at Delomaten skal kunne de-pseudonymisere data så krever den at de tekniske detaljene om hvordan dataene er pseudonymisert er dokumentert i Datadoc for hver variabel som skal prosesseres. Dvs. at feltene [krypteringsalgoritme](./datadoc-model.qmd#krypteringsalgoritme)  
:::


### Aktiver Delomaten

Delomaten er en [*feature*](./features.qmd) som må aktiveres for hvert som skal bruke den. Du aktiverer den i teamets IaC-repo slik som vist på linje 14 i eksempelet under:

```{.yaml filename="./infra/projects.yaml" caption="Eksempel på en feature" code-line-numbers="true"}
team_uniform_name: play-obr

projects:
  - project_name: play-obr
    env: test
    features:
      - dapla-buckets

  - project_name: play-obr
    env: prod
    features:
      - dapla-buckets
      - shared-buckets
      - delomaten
```

### Aktiver *shared-buckets*

Delomaten forutsetter at teamet har opprettet en Delomaten delt-bøtte før Delomaten-jobber settes opp. For å opprette delt-bøtter må man aktivere [feature]([*feature*](./features.qmd) )'n *shared-buckets*, slik som vist i linje 13 i eksempelet over.

### Opprett Delomaten-bøtte

Les mer om hvordan man oppretter bøttene etter at *feature*'n er skrudd på [i denne artikkelen](./deling-av-data.qmd).



## Sett opp tjenesten
For å sette opp Delomaten gjør følgende endringer i teamets IAC-repo:

1. **Sjekk at dataene er dokumentert**
   - Alle data som deles gjennom Delomaten må være dokumentert i [Datadoc](./datadoc.html).
   - Hver datafil må ha en tilhørende metadatafil (.json) som lastes opp samtidig.
   - Hvis metadatafilen mangler, vil jobben feile automatisk.

1. **Aktiver tjenesten**
   - Skru på `shared-buckets` og `Delomaten` under [Features](./features.html),
   - eller opprett en [kundeservice-sak](https://ssb.pureservice.com/#/categories/14/new).

2. **Opprett Delomaten-bøtte**
   - Følg veiledningen i [deling av data](./deling-av-data.qmd).

3. **Lag konfigurasjonsfil i GitHub**
   - Opprett `automation/shared-data/<Ditt team>-prod/<>/config.yaml`.
   - Beskriv hvilke kolonner som skal pseudonymiseres/depseudonymiseres.

---
## Konfigurasjonsfilen

Konfigurasjonsfilen (`config.yaml`) styrer hvordan Delomaten skal behandle dataen.
Filen må ligge i teamets IAC-repo, under `automation/shared-data/...`.

```{.yaml filename="github.com/statisticsnorway/dapla-example-iac"}
dapla-example-iac
├── automation/
│   ├── shared-data/
│   │   ├── dapla-example-prod/
│   │   │    └── altinn
│   │   │    └── ameld
│   │   └── dapla-example-test/
│   │        └── altinn
│   │        └── ameld
│   │        └── skatt
│   └── source-data/
│       ...
│...
```

### Viktige parametre

- **`shared_bucket`**
  Navnet på Delomaten-bøtta der resultatet lagres.

- **`source_folder_prefix`**
  Stien til kildedata i produktbøtta.
  - Hvis du setter `source_folder_prefix: "forbruk/"`, betyr det at alle filer under mappen `forbruk/` i produktbøtta deles.
  - Tips: Hvis du bare vil dele deler av mappen, kan du bruke underkataloger eller et mer spesifikt prefix.

- **`destination_folder`**
  Navnet på mappen i Delomaten-bøtta som mottakerne får tilgang til.
  - Vanligvis setter du samme navn som `source_folder_prefix`, men du kan velge fritt.

- **`memory_size`**
  Ressurser jobben maksimalt får tilgang til spesifisert i Gigabyte (for avanserte brukere).

- **`pseudo`**
  En liste over kolonner som skal pseudonymiseres, og hvilken algoritme som skal brukes.

- **`depseudo`**
  En liste over kolonner som skal depseudonymiseres. Hvilken algoritme som brukes bestemmes utfra metadataen til variabelen.

### Eksempeler på pseudonymisering
```{.yaml filename="automation/shared-data/mitt-dapla-team-prod/ledstill/config.yaml"}
shared_bucket: "delomatentest"
source_folder_prefix: "forbruk/"
destination_folder: "forbruk"
memory_size: 6
pseudo:
  - name: task_one
    columns: [ "fnr" ]
    encryption:
      algorithm: "sid_mapping"
      sid_snapshot_date: "2025-07-07"
```
Her pseudonymiseres kolonnen fnr med sid mapping og katalogdato `2025-07-07`.

```{.yaml filename="automation/shared-data/mitt-dapla-team-prod/ledstill/config.yaml"}
shared_bucket: "delomatentest"
source_folder_prefix: "forbruk/"
destination_folder: "forbruk"
memory_size: 6
pseudo:
  - name: task_one
    columns: [ "fnr" ]
    encryption:
      algorithm: "sid_mapping"
```
Her pseudonymiseres kolonnen fnr med sid mapping og siden katalogdato ikke er spesifisert brukes den nyeste.

```{.yaml filename="automation/shared-data/mitt-dapla-team-prod/ledstill/config.yaml"}
shared_bucket: "delomatentest"
source_folder_prefix: "forbruk/"
destination_folder: "forbruk"
memory_size: 6
pseudo:
  - name: task_one
    columns: [ "fnr" ]
    encryption:
      algorithm: "sid_mapping"
  - name: task_two
    columns: [ "snr" ]
    encryption:
      algorithm: "papis_compatible"
  - name: task_three
    columns: [ "fornavn", "etternavn" ]
    encryption:
      algorithm: "default"
```
Her pseudonymiseres flere kolonner med forskjellige algoritmer:

- `fnr` kolonnen pseudonymiseres med sid mapping og nyeste sid-katalog
- `snr` kolonnen pseudonymiseres med papis algoritmen, men uten noe sid mapping
- `fornavn` og `etternavn` kolonnene pseudonymiseres med `default` algoritmen som altså er DAEAD

### Eksempel på depseudonymisering
```{.yaml filename="automation/shared-data/mitt-dapla-team-prod/ledstill/config.yaml"}
shared_bucket: "delomatentest"
source_folder_prefix: "ledstill/"
destination_folder: "ledstill"
memory_size: 6
depseudo:
    columns: ["fnr", "fnr_naa"]
```
Her depseudonymiseres `fnr` og `fnr_naa` kolonnene med de samme algoritmene og parameterene som de ble pseudonymisert med.
 Denne informasjonen blir hentet fra datadoc metadataen til variablene.

## Feilmeldinger

Konfigurasjonsfilen valideres automatisk når du oppretter en pull request i GitHub.
Hvis noe er feil får du en tydelig feilmelding:
![Delomaten test feil](../images/delomaten_error.png)

Eksempel på feilmelding i workflow
![Delomaten feilmelding](../images/delomaten_error_msg.png)
