---
title: Oversikt
date-modified: 03/28/2025
lightbox: true
---

![](../images/altinn_logo.png){style="max-width: 50%; float: right;" fig-alt="Dapla logo"}

Frem mot sommeren 2026 skal alle skjema-unders칮kelser i SSB som gjennomf칮res p친 **Altinn 2** flyttes over til [Altinn 3](https://docs.altinn.studio/nb/community/about/). Skjemaer som flyttes til Altinn 3 vil motta sine data p친 **Dapla**, og ikke p친 *bakken* som tidligere. Datafangsten h친ndteres av [Team SU-V](https://statistics-norway.atlassian.net/wiki/spaces/CUL/pages/2805530625/Teamsider), mens statistikkseksjonene henter sine data fra Team SU-V sitt lagringsomr친de p친 Dapla. I dette kapitlet beskriver vi n칝rmere hvordan statistikkseksjonene kan jobbe med Altinn3-data p친 Dapla. Kort oppsummert best친r det av disse stegene:

1. Statistikkprodusenten avtaler overf칮ring av skjema fra **Altinn 2** til **Altinn 3** med planleggere p친 **S821**, som koordinerer denne jobben. 
2. N친r statistikkprodusentene f친r beskjed om at Altinn3-skjemaet skal sendes ut til oppgavegiverne, s친 m친 de opprette et [Dapla-team](./opprette-dapla-team.html).
3. N친r Dapla-teamet er opprettet, og f칮rste skjema er sendt inn, se ber de om at Team SU-V gir tilgang til teamets *Transfer Service* instans. S칮knad om tilgang gj칮res gjennom Kundeservice og [selvbetjeningsportalen](https://ssb.pureservice.com/). For 친 s칮ke om tilgang velger du **Meld sak til Sp칮rreunders칮kelser virksomhet (SU-V)**. Her vil du finne et eget skjema som du fyller ut for 친 s칮ke om tilgang. Merk at det m친 gis separate tilganger for data i test- og produksjonsmilj칮. 
4. Statistikkprodusenten setter opp en automatisk overf칮ring av skjemadata med [Transfer Service](./transfer-service.html), fra Team SU-V sitt lagringsomr친de over til Dapla-teamet sin kildeb칮tte.
5.  Statistikkprodusentene kan begynne 친 jobbe med dataene i Dapla. Blant annet tilbyr Dapla en **automatiseringstjeneste** som man kan bruke for 친 prosessere dataene fra kildedata til inndata^[En typisk prosessering som de fleste vil 칮nske 친 gj칮re er 친 konvertere fra xml-formatet det kom p친, og over til parquet-formatet.].

I resten av kapitlet gis en oversikt over hvordan statistikkteam kan jobbe med data fra Altinn 3. 


## Ansvarsfordeling

Team SU-V har ansvaret for datafangst fra Altinn3 til SSB. Deretter tilgjengeliggj칮r de dette for statistikkteamet som skal jobbe videre med dataene for 친 prodsuere statistikk. 

Det er statistikteamet som lagrer dataene som sin kildedata som er ansvarlig for dataene og at disse h친ndteres p친 riktig m친te. Av den grunn er det statistikteamet som setter opp jobben for 친 synkronisere data fra b칮tta til Team SU-V til sin kildeb칮tte, slik at de kan organisere dataene som de 칮nsker. I tillegg vil backup av data bli h친ndtert i kildeb칮tta til statistikkteamet.

## Tilgangsstyring

Skjemaer fra Altinn 3 hentes inn til SSB av team SU-V og lagres i delt-b칮tter som SU-V administrerer. SU-V kan deretter gi tilgang til statistikkteam slik at de hente data fra b칮ttene og lagre det i sine kildeb칮tter. Sine tilgangsstyring mellom **prod**- og **test**-milj칮et fungerer ulikt s친 forklarer vi hver av de under.

### Prod

Tilgang til b칮tter med skjemadata i prod-milj칮et gis kun til [Transfer Service](./transfer-service.qmd) for kildeprosjektet til statistikkteamet, og aldri direkte til brukere. Dvs. at team SU-V gir tilgang til Transfer Service til statistikkteamet, og deretter kan statistikkteamet sette opp en automatisk jobb med Transfer Service som synkroniserer data fra SU-V sin delt-b칮tte og over til statistikkteamets kildeb칮tte.

Siden tilgangsstyringen til data i prod er ganske restriktiv, s친 anbefaler vi at statistikere gj칮r seg kjent med sine skjemadata i test-milj칮et f칮r de starter arbeidet i prod. Les mer om tilgangsstyring test-milj칮et i neste kapittel.

### Test

Tilgang til b칮tter med skjemadata i test-milj칮et er mindre restriktive enn for prod-milj칮et, siden disse dataene er fiktive. Derfor anbefales det at statistikere f칮rst jobber i test-milj칮et n친r de skal gj칮re seg kjent med dataene fra Altinn 3. I test-milj칮et kan b친de brukere og Transfer Service f친 tilgang til SU-V sine delt-data. 

## Data

Dataene som hentes inn av Team SU-V lagres som **xml**-filer i en b칮tte. Statistikkteamet som skal hente inn dataene synkroniseres deretter dataene til sin delt-b칮tte med [Transfer Service](./transfer-service.qmd). Det finnes b친de data og metadata om hvert skjema som sendes inn og under forklares innholdet i hver av de. 

### Skjemadata

Hvert skjema som leveres inn av en oppgavegiver blir lagret som en separat xml-fil med et unikt filnavn^[Teknisk sett er hele filstien det samme som et filnavn i en b칮tte. Men det omtales heretter som *filnavn* og *filsti* for 친 kunne skille mellom hele stien, og det som tradisjonelt er oppfattet som filnavn.]. Under ser du et eksempel p친 hvordan et skjema kan se ut.

::: {.callout-caution collapse="true"}
## Eksempel p친 xml-fil

```xml
<?xml version="1.0" ?>
<melding xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" dataFormatProvider="SERES" dataFormatId="7079" dataFormatVersion="47315">
  <InternInfo>
    <raNummer>RA-XXXX</raNummer>
    <skjemaVersjon>1.0</skjemaVersjon>
    <undersoekelsesNr>XXXXX</undersoekelsesNr>
    <visOppgaveByrde>0</visOppgaveByrde>
    <visBrukeropplevelse>0</visBrukeropplevelse>
    <delregNr>2XXXXX</delregNr>
    <periodeFritekst>3. kvartal 2022</periodeFritekst>
    <periodeFomDato>2022-07-01</periodeFomDato>
    <periodeTomDato>2022-09-30</periodeTomDato>
    <periodeType>KVRT</periodeType>
    <periodeNummer>3</periodeNummer>
    <periodeAAr>2022</periodeAAr>
    <periodeDato> </periodeDato>
    <enhetsIdent>XXXXXX</enhetsIdent>
    <enhetsType>BEDR</enhetsType>
    <enhetsOrgNr>XXXXXXXXX</enhetsOrgNr>
    <enhetsNavn>STATISTISK SENTRALBYR칀 </enhetsNavn>
    <enhetsGateadresse>Akersveien 26</enhetsGateadresse>
    <enhetsPostnr>0177</enhetsPostnr>
    <enhetsPoststed>OSLO</enhetsPoststed>
    <enhetsAvdeling>AVD XXXX</enhetsAvdeling>
    <reporteeOrgNr>XXXXXXXXX</reporteeOrgNr>
  </InternInfo>
  <Kontakt>
    <kontaktPersonNavn>OLA NORDMANN</kontaktPersonNavn>
    <kontaktPersonEpost>ola@tull.no</kontaktPersonEpost>
    <kontaktPersonTelefon> </kontaktPersonTelefon>
    <kontaktInfoBekreftet>1</kontaktInfoBekreftet>
    <kontaktInfoKommentar>Dette er en et eksempel for Dapla-manualen</kontaktInfoKommentar>
  </Kontakt>
  <Skjemadata>
    <ledigeStillinger>75</ledigeStillinger>
    <datoPrefill> </datoPrefill>
  </Skjemadata>
</melding>
```	
:::


Filstien til filene i team SUV-V sine b칮tter f칮lger en streng navnestandard. @fig-altinn-path viser et eksempel p친 hvordan filstien til et fiktivt skjema kan se ut i b칮tta til team SU-V. Filstien har egenskapen at den er globalt unik og inneholder metadata om skjemaet.  

![Typisk filsti for et Altinn3-skjema.](../images/altinn_filsti.png){fig-alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr" #fig-altinn-path}

Av @fig-altinn-path  


### Metadata
For hver ny innsending fra Altinn3 (i test og prod)- tilrettelegger SU-V n친 en ekstra fil med metadata. Filen inneholder forel칮pig to variabler:

- **Referansenummeret** som oppgavegiver f친r ved innsending.
- **Tidspunkt** for n친r skjema er levert i Altinn3.

Brukerbehovet er i hovedsak dublettkontroll og svartjeneste. For dette trenger man et eksakt tidspunkt for n친r skjema faktisk ble sendt inn (trykket p친 knappen i Altinn). Merk at tidspunkt i fila er UTC.

Filen ligger i b칮ttene sammen med xml/pdf (og eventuelle vedlegg). Team T-Rex vil se videre p친 친 integrere dette inn i sin Python-pakke.

```json
{
    "altinnReferanse": "f23415ca6b2f", 
    "altinnTidspunktLevert": "2024-04-29T07:16:10.5080448Z"
}
```

![Metadata fra Altinn](../images/altinn-jobbe-med-altinn3-innsending-meta.png){fig-alt="Illustrasjon som viser innsending med metadata fra Altinn." #fig-altinn-jobbe-med-altinn3-innsending-meta}

## Forberedelse

N친r skjema-dataene kommer inn fra Altinn 3 til Team SU-V sitt lagringsomr친de, s친 er det en del ting som er verdt 친 tenke p친:

- **Hvordan er filene organisert hos Team SU-V?**  
Filstrukturen der Team SU-V lagrer dataene som kommer inn fra Altinn 3, har en klar struktur. Du kan selv g친 inn 친 kikke p친 dataene, enten [fra Jupyter](./jobbe-med-data.html) eller [Google Cloud Console](./gcc.html), og bli bedre kjent med strukturen^[Du kan g친 inn i [Google Cloud Console](./gcc.html) og s칮ke opp prosjektet til Team SU-V som de bruker for 친 dele data. Det heter **suv-altinn-data-p**, og du finner b칮ttene ved 친 klikke deg inn p친 **Cloud Storage**]. @fig-altinn-path viser en hvordan en typisk filsti ser ut p친 lagringsomr친det til Team SU-V. Det starter med navnet til b칮tta som Team SU-V har opprettet for skjemaet. Deretter viser den innvitteringsdato, deretter et teknisk navn, og til slutt selve skjemanavnet. 



- **Hvordan organisere dataene i din kildeb칮tte?**  
N친r vi bruker Transfer Service til 친 synkronisere innholdet i Team SU-V sitt lagringsomr친de til Dapla-teamet sitt lagringsomr친de, s친 er det mest hensiktmessig 친 fortsette 친 bruke mappe-strukturen som Team SU-V har. Grunnen er at vi ikke kan legge p친 noe logikk som lager en ny struktur. Tjenesten bare kopierer over data. Men du kan kan lage et nytt toppniv친-mappe som du 칮nsker at dataene skal synkroniseres til. F.eks. at alle Altinn-dataene legger seg inn i en mappe som heter `altinn`. Det er spesielt nyttig hvis du har flere datakilder som skal ligge i samme kildeb칮tte.

- **Unike skjemanavn**  
Skjemanavnet du ser i @fig-altinn-path er unike. Dvs. at hvis en oppgavegiver sender inn flere skjemaer p친 samme dag, s친 er fortsatt skjemanavnet unikt. Det er viktig 친 v칝re klar over n친r man bruker [automatiseringstjenesten for kildedata](./kildomaten.html) senere. Siden tjenesten trigges per fil, og man er avhengig av unike navn for 친 ikke skrive over filer, s친 er det nyttig 친 vite at man kan videref칮re skjemanavnet i overgangen fra kildedata til inndata. 

## Transfer Service

N친r vi skal overf칮re filer fra Team SU-V sin b칮tte til v친r kildeb칮tte, s친 kan vi gj칮re det manuelt fra Jupyter [som forklart her.](./altinn3.qmd#kopiere-filer-manuelt). Men det er en bedre l칮sning 친 bruke en tjeneste som gj칮r dette for deg. [Transfer Service](./transfer-service.html) er en tjeneste som kan brukes til 친 synkronisere innholdet mellom b칮tter p친 Dapla, samt mellom bakke og sky. N친r du skal ta i bruk tjenesten for 친 overf칮re data mellom en b칮tte fra Team SU-V sitt prosjekt **suv-altinn-data-p**, til en kildedata-b칮tte i Dapla-teamet ditt, s친 gj칮r du f칮lgende: 

1. F칮lg denne beskrivelsen hvordan man [setter opp overf칮ringsjobber](./transfer-service.html#overf칮ring-av-data).
2. Etter at du har trykket p친 `Create Transfer Job` velger du **Google Cloud Storage** p친 begge alternativene under **Get Started**. Deretter g친r du videre ved 친 klikke p친 **Next Step**.
3. Under **Choose a source** s친 skal du velge hvor du skal kopiere data fra. Trykk p친 **Browse**. I vinduet som dukker opp trykker du p친 游댵-ikonet ved siden av **Project ID**. I s칮kevinduet som dukker opp s칮ker du opp **suv-altinn-data-p** og trykker p친 navnet. Da f친r du listet opp alle b칮ttene i suv-altinn-data-p prosjektet. Til slutt trykker du p친 b칮tta som Team SU-V har opprettet for unders칮kelsen^[B칮ttenavnet starter alltid med RA-nummeret til unders칮kelsen.] og klikker **Select** til nederst p친 siden. Trykk deretter **Next step** for 친 g친 videre. 
4. Under **Choose a destination** s친 skal du velge hvor du skal kopiere data til. Dette steget er ganske likt som forrige, men du skal n친 velge ditt eget projekt og kildeb칮tta der. Trykk p친 **Browse**. I vinduet som dukker opp trykker du p친 游댵-ikonet ved siden av **Project ID**. I s칮kevinduet som dukker opp s칮ker du opp **\<ditt teamnavn\>-kilde-\<milj칮\>** og trykker p친 navnet. Da f친r du listet opp alle b칮ttene i ditt team sitt prosjekt. Velg kildeb칮tta som har navnet **ssb-\<teamnavn\>-kilde-<milj칮\>**. Hvis du 칮nsker 친 kopiere data til en undermappe i b칮tta, s친 trykker du p친 <span style="color:red;">**>**</span>-ikonet ved b칮ttenavnet og velger 칮nsket undermappe^[Alternativt oppretter du en mappe direkte vinduet ved 친 trykke p친 mappe-ikonet med en **+**-tegn i seg.]. Til slutt trykker du p친 **Select** til nederst p친 siden. Trykk deretter **Next step** for 친 g친 videre.
5. Under **Choose how and when to run job** velger du **Run with custom frequency** og **Starting now** i **Batch**-modus. Hvis du 칮nsker 친 overf칮re s친 ofte som mulig, s친 velger du **Custom frequency** og **Repeat every 1 Hours**. Til slutt trykker du **Next Step** nederst p친 siden.
6. Under **Choose Settings** s친 legger du til en kort beskrivelse av jobben du har opprettet. Under de andre valgene kan du gj칮re f칮lgende: 
    - Under **Advanced transfer Options** trenger du ikke gj칮re noen endringer. 
    - Under **When to overwrite** kan du velge **If different**.
    - Under **When to delete** kan du velge **Never**.
    - Under **Manifest** trenger du ikke huke av. 
    - Under **Logging options** velger du samme som vist i @fig-ts-log.

![Valg av opsjoner for logging i Transfer Service](../images/transfer-service-logging.png){fig-alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr" #fig-ts-log}

Til slutt trykker du **Create** for 친 aktivere tjenesten. Den vil da sjekke Team SU-V sin b칮tte hver time og kopiere over alle filer som ikke allerede eksisterer statistikkteamets kildeb칮tte. 

## Automatiseringstjeneste for kildedata
N친r du har satt opp Transfer Service til 친 kopiere over filer fra Team SU-V sin b칮tte til statistikkteamets kildeb칮tte, s친 vil det potensielt komme inn nye skjemaer hver time. Disse kan du lese inn i **Jupyter** og jobbe med hvis du er kildedata-ansvarlig i teamet. Hvis du ikke er det s친 m친 du vente til dataene er tilgjengeliggjort i produkt-b칮tta til teamet. 

Siden f친 personer innehar rollen som kildedata-ansvarlig s친 er det laget en automatiseringstjeneste som kan bearbeide alle filer som kommer inn i kildeb칮tta. Den lar deg kj칮re et python-script p친 alle filer som kommer inn i kildeb칮tta. 

[Les mer om hvordan du kan bruker tjenesten her.](./kildomaten.html)

## Overf칮re Altinn3-filer til ISEE
Det er utviklet en [Altinn3-pakke](https://statistics-norway.atlassian.net/wiki/spaces/altinnpython/overview#Python-pakken-ssb-altinn-python-for-utflating-av-XML-filer) i Python som flater ut mottatte XML-filer og som lager en csv-fil som er p친 ISEE-format av innholdet.

[Dokumentasjon](https://statisticsnorway.github.io/ssb-altinn-python/) og [reference guide](https://statisticsnorway.github.io/ssb-altinn-python/reference.html) av pakken.

Pakken ssb-altinn-python er tilgjengelig i Kildomaten, og kan benyttes for 친 automatisk flate ut Altinn3-skjema mellom kilde- og produktb칮tte.
