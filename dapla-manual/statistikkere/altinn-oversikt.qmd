---
title: Oversikt
date-modified: 04/04/2025
lightbox: true
---

![](../images/altinn_logo.png){style="max-width: 50%; float: right;" fig-alt="Dapla logo"}

Frem mot sommeren 2026 skal alle skjema-undersÃ¸kelser i SSB som gjennomfÃ¸res pÃ¥ **Altinn 2** flyttes over til [Altinn 3](https://docs.altinn.studio/nb/community/about/). Skjemaer som flyttes til Altinn 3 vil motta sine data pÃ¥ **Dapla**, og ikke pÃ¥ *bakken* som tidligere. Datafangsten hÃ¥ndteres av [Team SU-V](https://statistics-norway.atlassian.net/wiki/spaces/CUL/pages/2805530625/Teamsider), mens statistikkseksjonene henter sine data fra Team SU-V sitt lagringsomrÃ¥de pÃ¥ Dapla. I dette kapitlet beskriver vi nÃ¦rmere hvordan statistikkseksjonene kan jobbe med Altinn3-data pÃ¥ Dapla. Kort oppsummert bestÃ¥r det av disse stegene:

1. Statistikkprodusenten avtaler overfÃ¸ring av skjema fra **Altinn 2** til **Altinn 3** med planleggere pÃ¥ **S821**, som koordinerer denne jobben. 
2. NÃ¥r statistikkprodusentene fÃ¥r beskjed om at Altinn3-skjemaet skal sendes ut til oppgavegiverne, sÃ¥ mÃ¥ de opprette et [Dapla-team](./opprette-dapla-team.html).
3. NÃ¥r Dapla-teamet er opprettet, og fÃ¸rste skjema er sendt inn, se ber de om at Team SU-V gir tilgang til teamets *Transfer Service* instans. SÃ¸knad om tilgang gjÃ¸res gjennom Kundeservice og [selvbetjeningsportalen](https://ssb.pureservice.com/). For Ã¥ sÃ¸ke om tilgang velger du **Meld sak til SpÃ¸rreundersÃ¸kelser virksomhet (SU-V)**. Her vil du finne et eget skjema som du fyller ut for Ã¥ sÃ¸ke om tilgang. Merk at det mÃ¥ gis separate tilganger for data i test- og produksjonsmiljÃ¸. 
4. Statistikkprodusenten setter opp en automatisk overfÃ¸ring av skjemadata med [Transfer Service](./transfer-service.html), fra Team SU-V sitt lagringsomrÃ¥de over til Dapla-teamet sin kildebÃ¸tte.
5.  Statistikkprodusentene kan begynne Ã¥ jobbe med dataene i Dapla. Blant annet tilbyr Dapla en **automatiseringstjeneste** som man kan bruke for Ã¥ prosessere dataene fra kildedata til inndata^[En typisk prosessering som de fleste vil Ã¸nske Ã¥ gjÃ¸re er Ã¥ konvertere fra xml-formatet det kom pÃ¥, og over til parquet-formatet.].

I resten av kapitlet gis en oversikt over hvordan statistikkteam kan jobbe med data fra Altinn 3. 


## Ansvarsfordeling

Team SU-V har ansvaret for datafangst fra Altinn3 til SSB. Deretter tilgjengeliggjÃ¸r de dette for statistikkteamet som skal jobbe videre med dataene for Ã¥ produsere statistikk. 

Det er statistikteamet som lagrer dataene som sin kildedata som er ansvarlig for dataene og at disse hÃ¥ndteres pÃ¥ riktig mÃ¥te. Av den grunn er det statistikteamet som setter opp jobben for Ã¥ synkronisere data fra bÃ¸tta til Team SU-V til sin kildebÃ¸tte, slik at de kan organisere dataene som de Ã¸nsker. I tillegg vil backup av data bli hÃ¥ndtert i kildebÃ¸tta til statistikkteamet.

## Tilgangsstyring

Skjemaer fra Altinn 3 hentes inn til SSB av team SU-V og lagres i delt-bÃ¸tter som SU-V administrerer. SU-V kan deretter gi tilgang til statistikkteam slik at de hente data fra bÃ¸ttene og lagre det i sine kildebÃ¸tter. Siden tilgangsstyring mellom **prod**- og **test**-miljÃ¸et fungerer ulikt sÃ¥ forklarer vi hver av de under.

### Prod

Tilgang til bÃ¸tter med skjemadata i prod-miljÃ¸et gis kun til [Transfer Service](./transfer-service.qmd) for kildeprosjektet til statistikkteamet, og aldri direkte til brukere. Dvs. at team SU-V gir tilgang til Transfer Service til statistikkteamet, og deretter kan statistikkteamet sette opp en automatisk jobb med Transfer Service som synkroniserer data fra SU-V sin delt-bÃ¸tte og over til statistikkteamets kildebÃ¸tte.

Siden tilgangsstyringen til data i prod er ganske restriktiv, sÃ¥ anbefaler vi at statistikere gjÃ¸r seg kjent med sine skjemadata i test-miljÃ¸et (se under) fÃ¸r de starter arbeidet i prod. 

### Test

Tilgang til bÃ¸tter med skjemadata i test-miljÃ¸et er mindre restriktive enn for prod-miljÃ¸et, siden disse dataene er fiktive. Derfor anbefales det at statistikere fÃ¸rst jobber i test-miljÃ¸et nÃ¥r de skal gjÃ¸re seg kjent med dataene fra Altinn 3. I test-miljÃ¸et kan bÃ¥de brukere og Transfer Service fÃ¥ tilgang til SU-V sine delt-data. 

## Data

Dataene som hentes inn av Team SU-V lagres som **xml**-filer i en bÃ¸tte. Statistikkteamet som skal hente inn dataene synkroniseres deretter dataene til sin delt-bÃ¸tte med [Transfer Service](./transfer-service.qmd). Det finnes bÃ¥de data og metadata om hvert skjema som sendes inn og under forklares innholdet i hver av de. 

### Skjemadata

Hvert skjema som leveres inn av en oppgavegiver blir lagret som en separat xml-fil med et unikt filnavn^[Teknisk sett er hele filstien det samme som et filnavn i en bÃ¸tte. Men det omtales heretter som *filnavn* og *filsti* for Ã¥ kunne skille mellom hele stien, og det som tradisjonelt er oppfattet som filnavn.]. Under ser du et eksempel pÃ¥ hvordan et skjema kan se ut.

::: {.callout-caution collapse="true"}
## Eksempel pÃ¥ xml-fil

```xml
<?xml version="1.0" ?>
<melding xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" dataFormatProvider="SERES" dataFormatId="7079" dataFormatVersion="47315">
  <InternInfo>
    <raNummer>RA-XXXX</raNummer>
    <skjemaVersjon>1.0</skjemaVersjon>
    <undersoekelsesNr>XXXXX</undersoekelsesNr>
    <visOppgaveByrde>0</visOppgaveByrde>
    <visBrukeropplevelse>0</visBrukeropplevelse>
    <delregNr>2XXXXX</delregNr>
    <periodeFritekst>3. kvartal 2022</periodeFritekst>
    <periodeFomDato>2022-07-01</periodeFomDato>
    <periodeTomDato>2022-09-30</periodeTomDato>
    <periodeType>KVRT</periodeType>
    <periodeNummer>3</periodeNummer>
    <periodeAAr>2022</periodeAAr>
    <periodeDato> </periodeDato>
    <enhetsIdent>XXXXXX</enhetsIdent>
    <enhetsType>BEDR</enhetsType>
    <enhetsOrgNr>XXXXXXXXX</enhetsOrgNr>
    <enhetsNavn>STATISTISK SENTRALBYRÃ… </enhetsNavn>
    <enhetsGateadresse>Akersveien 26</enhetsGateadresse>
    <enhetsPostnr>0177</enhetsPostnr>
    <enhetsPoststed>OSLO</enhetsPoststed>
    <enhetsAvdeling>AVD XXXX</enhetsAvdeling>
    <reporteeOrgNr>XXXXXXXXX</reporteeOrgNr>
  </InternInfo>
  <Kontakt>
    <kontaktPersonNavn>OLA NORDMANN</kontaktPersonNavn>
    <kontaktPersonEpost>ola@tull.no</kontaktPersonEpost>
    <kontaktPersonTelefon> </kontaktPersonTelefon>
    <kontaktInfoBekreftet>1</kontaktInfoBekreftet>
    <kontaktInfoKommentar>Dette er en et eksempel for Dapla-manualen</kontaktInfoKommentar>
  </Kontakt>
  <Skjemadata>
    <ledigeStillinger>75</ledigeStillinger>
    <datoPrefill> </datoPrefill>
  </Skjemadata>
</melding>
```	
:::


Filstien til filene i team SUV-V sine delt-bÃ¸tter fÃ¸lger en streng navnestandard. @fig-altinn-path viser et eksempel pÃ¥ hvordan filstien til et fiktivt skjema kan se ut i bÃ¸tta til team SU-V. Filstien har egenskapen at den er globalt unik og inneholder informasjon om tidspunktet skjemaet ble innkvittert i SSB sine systemer.  

![Typisk filsti for et Altinn3-skjema.](../images/altinn_filsti.png){fig-alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr" #fig-altinn-path} 

Skjemanavnet du ser i @fig-altinn-path er unike. Dvs. at hvis en oppgavegiver sender inn flere skjemaer pÃ¥ samme dag, sÃ¥ er fortsatt skjemanavnet unikt. Det er viktig Ã¥ vÃ¦re klar over nÃ¥r man bruker [automatiseringstjenesten for kildedata](./kildomaten.html) senere. Siden tjenesten trigges per fil, og man er avhengig av unike navn for Ã¥ ikke skrive over filer, sÃ¥ er det nyttig Ã¥ vite at man kan viderefÃ¸re skjemanavnet i overgangen fra kildedata til inndata. 


### Metadata
For hver ny innsending fra Altinn3 i test- og prod-miljÃ¸et, sÃ¥ tilrettelegger team SU-V en json-fil med metadata om innsedningen. Filen inneholder forelÃ¸pig to variabler:

- **Referansenummeret** som oppgavegiver fÃ¥r ved innsending.
- **Tidspunkt** for nÃ¥r skjema er levert i Altinn3.

Brukerbehovet er i hovedsak dublettkontroll og svartjeneste. For dette trenger man et eksakt tidspunkt for nÃ¥r skjema faktisk ble sendt inn (trykket pÃ¥ knappen i Altinn). Merk at tidspunkt i fila er UTC.

Filen ligger i bÃ¸ttene sammen med xml/pdf (og eventuelle vedlegg). Team T-Rex vil se videre pÃ¥ Ã¥ integrere dette inn i sin Python-pakke.

```json
{
    "altinnReferanse": "f23415ca6b2f", 
    "altinnTidspunktLevert": "2024-04-29T07:16:10.5080448Z"
}
```

![Metadata fra Altinn](../images/altinn-jobbe-med-altinn3-innsending-meta.png){fig-alt="Illustrasjon som viser innsending med metadata fra Altinn." #fig-altinn-jobbe-med-altinn3-innsending-meta}

## Synkronisering av data

NÃ¥r et statistikkteam har fÃ¥tt beskjed av team SU-V at data er tilgjengelig deres delt-bÃ¸tte og at statistikkteamets Transfer Service har fÃ¥tt tilgang, sÃ¥ kan man sette opp synkronisering av data fra team SU-V til statistikkteamets kildebÃ¸tte. 

NÃ¥r man synkroniserer data fra team SU-V til egen kildebÃ¸tte er det anbefalt Ã¥ gjÃ¸re fÃ¸lgende:

**Lag en mappe per skjema**  
FÃ¸r man setter opp synkroniseringen bÃ¸r man opprette en mappe per datakilde som teamet har. Dette inkluderer bÃ¥de Altinn-kilder og andre kilder. Hvis teamet har flere skjemaer fra Altinn sÃ¥ kan man f.eks. bruke skjemanummer som Ã¸verste mappenivÃ¥ i kildebÃ¸tta, og synkronisere hvert skjema til sin egen undermappe.

::: {.callout-caution collapse="true"}
## Eksempel pÃ¥ mappestruktur

```{.bash}
ssb-dapla-felles-data-kilde-prod
â”œâ”€â”€ altinn
â”‚   â”œâ”€â”€ ra0678
â”‚   â””â”€â”€ ra0778
â””â”€â”€ andrekilder

```
:::


**Behold mappestrukturen til team SU-V**  
NÃ¥r vi bruker Transfer Service til Ã¥ synkronisere innholdet i Team SU-V sitt lagringsomrÃ¥de til Dapla-teamet sin kildebÃ¸tte, sÃ¥ er det anbefalt Ã¥ fortsette Ã¥ bruke mappe-strukturen som Team SU-V har for Ã¥ sikre at ingen filer blir overskrevet pÃ¥ grunn av at de har identiske navn. 

::: {.callout-caution collapse="true"}
## Eksempel pÃ¥ mappestruktur for ra0678

```{.bash}
ssb-dapla-felles-data-kilde-prod
â”œâ”€â”€ altinn
â”‚   â”œâ”€â”€ ra0678
â”‚   â”‚   â””â”€â”€ 2026
â”‚   â”‚       â””â”€â”€ 3
â”‚   â”‚           â””â”€â”€ 28
â”‚   â”‚               â””â”€â”€ b66abe1880cc_a35bceb7-950d-4e9b-a4a0-caea736ab270
â”‚   â”‚                   â””â”€â”€ form_b66abe1880cc.xml
â”‚   â””â”€â”€ ra0778
â””â”€â”€ andrekilder
```
:::

### Transfer Service

NÃ¥r vi skal overfÃ¸re filer fra Team SU-V sin bÃ¸tte til vÃ¥r kildebÃ¸tte, sÃ¥ kan vi gjÃ¸re det manuelt fra Jupyter som forklart her.. Men det er en bedre lÃ¸sning Ã¥ bruke en tjeneste som gjÃ¸r dette for deg. [Transfer Service](./transfer-service.html) er en tjeneste som kan brukes til Ã¥ synkronisere innholdet mellom bÃ¸tter pÃ¥ Dapla, samt mellom bakke og sky. NÃ¥r du skal ta i bruk tjenesten for Ã¥ overfÃ¸re data mellom en bÃ¸tte fra Team SU-V sitt prosjekt **suv-altinn-data-p**, til en kildedata-bÃ¸tte i Dapla-teamet ditt, sÃ¥ gjÃ¸r du fÃ¸lgende: 

1. FÃ¸lg denne beskrivelsen hvordan man [setter opp overfÃ¸ringsjobber](./transfer-service.html#overfÃ¸ring-av-data).
2. Etter at du har trykket pÃ¥ `Create Transfer Job` velger du **Google Cloud Storage** pÃ¥ begge alternativene under **Get Started**. Deretter gÃ¥r du videre ved Ã¥ klikke pÃ¥ **Next Step**.
3. Under **Choose a source** sÃ¥ skal du velge hvor du skal kopiere data fra. Trykk pÃ¥ **Browse**. I vinduet som dukker opp trykker du pÃ¥ ğŸ”»-ikonet ved siden av **Project ID**. I sÃ¸kevinduet som dukker opp sÃ¸ker du opp **suv-altinn-data-p** og trykker pÃ¥ navnet. Da fÃ¥r du listet opp alle bÃ¸ttene i suv-altinn-data-p prosjektet. Til slutt trykker du pÃ¥ bÃ¸tta som Team SU-V har opprettet for undersÃ¸kelsen^[BÃ¸ttenavnet starter alltid med RA-nummeret til undersÃ¸kelsen.] og klikker **Select** til nederst pÃ¥ siden. Trykk deretter **Next step** for Ã¥ gÃ¥ videre. 
4. Under **Choose a destination** sÃ¥ skal du velge hvor du skal kopiere data til. Dette steget er ganske likt som forrige, men du skal nÃ¥ velge ditt eget projekt og kildebÃ¸tta der. Trykk pÃ¥ **Browse**. I vinduet som dukker opp trykker du pÃ¥ ğŸ”»-ikonet ved siden av **Project ID**. I sÃ¸kevinduet som dukker opp sÃ¸ker du opp **\<ditt teamnavn\>-kilde-\<miljÃ¸\>** og trykker pÃ¥ navnet. Da fÃ¥r du listet opp alle bÃ¸ttene i ditt team sitt prosjekt. Velg kildebÃ¸tta som har navnet **ssb-\<teamnavn\>-kilde-<miljÃ¸\>**. Hvis du Ã¸nsker Ã¥ kopiere data til en undermappe i bÃ¸tta, sÃ¥ trykker du pÃ¥ <span style="color:red;">**>**</span>-ikonet ved bÃ¸ttenavnet og velger Ã¸nsket undermappe^[Alternativt oppretter du en mappe direkte vinduet ved Ã¥ trykke pÃ¥ mappe-ikonet med en **+**-tegn i seg.]. Til slutt trykker du pÃ¥ **Select** til nederst pÃ¥ siden. Trykk deretter **Next step** for Ã¥ gÃ¥ videre.
5. Under **Choose how and when to run job** velger du **Run with custom frequency** og **Starting now** i **Batch**-modus. Hvis du Ã¸nsker Ã¥ overfÃ¸re sÃ¥ ofte som mulig, sÃ¥ velger du **Custom frequency** og **Repeat every 1 Hours**. Til slutt trykker du **Next Step** nederst pÃ¥ siden.
6. Under **Choose Settings** sÃ¥ legger du til en kort beskrivelse av jobben du har opprettet. Under de andre valgene kan du gjÃ¸re fÃ¸lgende: 
    - Under **Advanced transfer Options** trenger du ikke gjÃ¸re noen endringer. 
    - Under **When to overwrite** kan du velge **If different**.
    - Under **When to delete** kan du velge **Never**.
    - Under **Manifest** trenger du ikke huke av. 
    - Under **Logging options** velger du samme som vist i @fig-ts-log.

![Valg av opsjoner for logging i Transfer Service](../images/transfer-service-logging.png){fig-alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr" #fig-ts-log}

Til slutt trykker du **Create** for Ã¥ aktivere tjenesten. Den vil da sjekke Team SU-V sin bÃ¸tte hver time og kopiere over alle filer som ikke allerede eksisterer statistikkteamets kildebÃ¸tte. 

## Kildomaten
NÃ¥r du har satt opp Transfer Service til Ã¥ kopiere over filer fra Team SU-V sin bÃ¸tte til statistikkteamets kildebÃ¸tte, sÃ¥ vil det potensielt komme inn nye skjemaer hver time. Siden ingen pÃ¥ statistikkteamet har tilgang til kildebÃ¸tta som standard^[Kun data-admins i teamet kan aktivere tilgang ved behov], sÃ¥ er neste steg Ã¥ prosessere dataene med [Kildomaten](./kildomaten.qmd) og lagre dataene i produktbÃ¸tta hvot alle i teamet har tilgang. 

[Les mer om hvordan du kan bruker tjenesten her.](./kildomaten.html)

## Altinn3 til ISEE

Enkelte Dapla-team mÃ¥ flytte sine skjemaer over til Altinn 3, men Ã¸nsker Ã¥ bruke ISEE videre i produksjonsprosessen. Det er fullt mulig og [dokumentert her](https://statistics-norway.atlassian.net/wiki/spaces/altinnpython/overview#Python-pakken-ssb-altinn-python-for-utflating-av-XML-filer).

Det er ogsÃ¥ utviklet en [Altinn3-pakke](https://statisticsnorway.github.io/ssb-altinn-python/) i Python som flater ut XML-filer fra Altinn 3 og lager en csv-fil som er pÃ¥ ISEE-format av innholdet. *ssb-altinn-python* er tilgjengelig i Kildomaten, og kan benyttes for Ã¥ automatisk flate ut Altinn3-skjema mellom kilde- og produktbÃ¸tte.

Det er ogsÃ¥ [skrevet et blogginnlegg](../blog/posts/2025-04-07-altinn3-til-isee/index.qmd) som beskriver i mer detaljer hvordan man inkludere Altinn 3, Dapla og ISEE i et produksjonslÃ¸p. 
