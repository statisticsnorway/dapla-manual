{
  "hash": "188d38e370a3b698bc38599a9f9b9234",
  "result": {
    "markdown": "---\ntitle: Deling av data\nfreeze: true\nexecute:\n    echo: false\n    include: true\n\n---\n\n::: {.cell execution_count=1}\n\n::: {.cell-output .cell-output-stdout}\n```\nSist endret: 2024-06-08 av Øyvind Bruer-Skarsbø\n```\n:::\n:::\n\n\nDapla-team kan dele data mellom team via såkalte delt-bøtter. Hvert team kan opprette de delt-bøttene de har behov for, og deretter gi tilgang til grupper i andre team. Opprettelse av bøtter skal følge [retningslinjene som er definert her](https://statistics-norway.atlassian.net/wiki/spaces/DAPLA/pages/3613786151/Deling+av+data+p+Dapla).\n\n## Forberedelser\n\nFor å opprette delt-bøtter må man først skru på [featuren shared-buckets]() for teamet. Det gjøres ved at en på teamet gjør følgende:\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n1. Gå til IaC-repoet til teamet på Github.\n2. Åpne filen `./infra/projects.yaml`.\n3. Legg til en linje med `shared-buckets` under `features` i miljøet du ønsker, slik som vist til høyre.\n4. Opprette en PR med endringen.\n5. Be en i gruppa **data-admins** se over endringen og godkjenne.\n6. Kjør `atlantis plan` og `atlantis apply` slik som [beskrevet her](./features.html#aktivere-feature).  \n:::\n\n::: {.column width=\"5%\"}\n<!-- empty column to create gap -->\n:::\n\n::: {.column width=\"45%\"}\n```{.yaml filename=\"projects.yaml\"}\nteam_uniform_name: dapla-example\n\nprojects:\n  - project_name: dapla-example\n    env: prod\n    features:\n      - dapla-buckets\n      - transfer-service\n      - shared-buckets\n```\n:::\n\n::::\n\n## Opprettelse av bøtte\n\nOpprettelse av delt-bøtter gjøres i teamets IaC-repo. For å opprette en delt-bøtte må man legge til en linje i fila `./infra/projects/<teamnavn>-prod/buckets-shared.yaml`. Du legger bare til kortnavnet for bøtta, altså den delen av bøtte-navnet som teamet kan styre selv. For å opprette en bøtte med kortnavn `freg`, så fyller man bare inn følgende:\n\n```{.yml filename=buckets-shared.yaml code-line-numbers=\"true\"}\n# Use this file to create new buckets for sharing data easily.\n# Simply add a line with a dash and your new shared bucket's name:\n# - my-shared-data\n# This will create a bucket with the name ssb-arbmark-register-data-delt-my-shared-data-prod\n- freg\n```\nDe 5 første linjene er bare kommentarer som forteller hvordan man oppretter bøttene. På linje 6 ser vi hva som måtte fylles ut for å opprette en bøtte med kortnavn `freg`, som igjen får bøttenavnet:\n\n`ssb-<teamnavn>-data-delt-freg-prod`\n\nEtter at endringen er gjort i `buckets-shared.yaml`, så gjør du følgende:\n\n1. Opprette en PR på repoet med endringen.\n2. Få en i gruppen **data-admins** til å gå gjennom og godkjenne. \n3. Kjør `atlantis plan` og `atlantis apply` som [beskrevet her](./features.html#aktivere-feature).\n\n\n::: {.callout-warning}\n## Navngivning av bøtter\n\nNavngivning av bøtter følger [RFC 1123](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names). Dvs. at navnet må følge disse reglene:  \n\n- Max 63 tegn i navnet (gjelder fullt navn på bøtta)\n- kun små bokstaver `a-z` og sifre `0-9`\n- tillatt med `-`\n:::\n\n\n## Tilgangsstyring\n\nTilgangsstyringen til delt-bøtta kan gjøres av teamet som eier bøtta. Hvem som har tilgang blir definert i fila `./infra/projects/<teamnavn>-prod/iam.yaml` i IaC-repoet til teamet. Under ser man strukturen på `iam.yaml` for å gi tilgang til delt-bøtter:\n\n```{.yml filename=iam.yaml code-line-numbers=\"true\"}\nbuckets:\n  ssb-dapla-example-data-delt-freg-prod:\n    team-alpha-data-admins:\n    - ssb.bucket.read\n    team-alpha-developers:\n    - ssb.bucket.read\n\n  ssb-dapla-example-data-delt-ameld-prod:\n    team-beta-developers:\n    - ssb.bucket.read\n```\n\nOver ser vi at teamet **dapla-example** har to delt-bøtter:\n\n1. ssb-dapla-example-data-delt-freg-prod\n2. ssb-dapla-example-data-delt-ameld-prod\n\nDen første bøtta har de gitt lesetilgang til **data-admins** og **developers** i **team-alpha**. Fra linje 8 og nedover ser vi at de har gitt **developers** i **team-beta** lesetilgang til `ssb-dapla-example-data-delt-ameld-prod`.\n\nNår man har gjort endringer i `iam.yaml` så gjør man følgende:\n\n1. Opprette en PR med endringen. \n2. Få en i gruppen **data-admins** til å gå gjennom endringen og godkjenne.\n3. Kjør `atlantis plan` og `atlantis apply` som [beskrevet her](./features.html#aktivere-feature).\n\n",
    "supporting": [
      "deling-av-data_files"
    ],
    "filters": [],
    "includes": {}
  }
}