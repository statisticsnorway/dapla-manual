<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jonathan Husø">
<meta name="dcterms.date" content="2024-12-16">

<title>Intro til Pandera – Dapla-manualen</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../images/dapla-favicon.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-4a0c90c019d8ab040e8a87bb0602eedd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Ingen resultater",
    "search-matching-documents-text": "treff",
    "search-copy-link-title": "Kopier link til søk",
    "search-hide-matches-text": "Skjul flere treff",
    "search-more-match-text": "flere treff i dokumentet",
    "search-more-matches-text": "flere treff i dokumentet",
    "search-clear-button-title": "Nullstill",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Send",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e3f1e6;
      }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<meta property="og:title" content="Intro til Pandera – Dapla-manualen">
<meta property="og:description" content="Data validering i kode med Pandera.">
<meta property="og:image" content="https://manual.dapla.ssb.no/blog/posts/2024-12-16-data-validering-pandera/Pandera-Python-package.png">
<meta property="og:site_name" content="Dapla-manualen">
<meta property="og:image:height" content="114">
<meta property="og:image:width" content="390">
<meta property="og:image:alt" content="Logo til Pandera">
<meta name="twitter:title" content="Intro til Pandera – Dapla-manualen">
<meta name="twitter:description" content="Data validering i kode med Pandera.">
<meta name="twitter:image" content="https://manual.dapla.ssb.no/blog/posts/2024-12-16-data-validering-pandera/Pandera-Python-package.png">
<meta name="twitter:image-height" content="114">
<meta name="twitter:image-width" content="390">
<meta name="twitter:image:alt" content="Logo til Pandera">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../images/dapla-long.png" alt="Logo for Dapla" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Dapla-manualen</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../statistikkere/index.html"> 
<span class="menu-text">Manual</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../utviklere/lenker.html"> 
<span class="menu-text">Utviklere</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../news/index.html"> 
<span class="menu-text">Nyheter</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog/index.html"> 
<span class="menu-text">Blogg</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../notebooks/index.html"> 
<span class="menu-text">Eksempler</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../om-dapla.html"> 
<span class="menu-text">Om Dapla</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hjelp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hjelp</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hjelp">    
        <li>
    <a class="dropdown-item" href="https://start.dapla.ssb.no/"><i class="bi bi-people-fill" role="img">
</i> 
 <span class="dropdown-text">Dapla Ctrl</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://web.yammer.com/main/org/ssb.no/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiI5MDUzMjA2In0/all"><i class="bi bi-people-fill" role="img">
</i> 
 <span class="dropdown-text">Diskusjonsforum</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ssb.pureservice.com/#/new/7"><i class="bi bi-send-fill" role="img">
</i> 
 <span class="dropdown-text">Kundeservice</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../faq.html"><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="dropdown-text">FAQ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../faq-dapla-lab.html"><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="dropdown-text">FAQ Dapla Lab</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-logg-inn" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-person-circle" role="img">
</i> 
 <span class="menu-text">Logg inn</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-logg-inn">    
        <li>
    <a class="dropdown-item" href="https://lab.dapla.ssb.no/"><i class="bi bi-graph-up" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (prod)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://lab.dapla-test.ssb.no/"><i class="bi bi-graph-up-arrow" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (test)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://lab.dapla-dev.ssb.no/"><i class="bi bi-graph-up-arrow" role="img">
</i> 
 <span class="dropdown-text">Dapla Lab (dev)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jupyter.dapla.ssb.no/"><i class="bi bi-journal-code" role="img">
</i> 
 <span class="dropdown-text">JupyterLab (prod)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://jupyter.dapla-staging.ssb.no/"><i class="bi bi-journal-code" role="img">
</i> 
 <span class="dropdown-text">JupyterLab (staging)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://console.cloud.google.com/"><i class="bi bi-google" role="img">
</i> 
 <span class="dropdown-text">Google Cloud Console</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://datahub.external.staging.ssb.cloud.nais.io/explore"><i class="bi bi-database-fill" role="img">
</i> 
 <span class="dropdown-text">DaplaHub (POC)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://dapla-ctrl.intern.ssb.no/"><i class="bi bi-controller" role="img">
</i> 
 <span class="dropdown-text">Dapla Ctrl</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/statisticsnorway/dapla-manual"> <i class="bi bi-github" role="img" aria-label="Dapla-manual GitHub repository">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Intro til Pandera</h1>
            <p class="subtitle lead">Data validering i kode med Pandera.</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Data validering</div>
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Pandera</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Forfatter</div>
    <div class="quarto-title-meta-heading">Tilhører</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Jonathan Husø </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Seksjon for Utenrikshandelsstatistikk (214)
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Opprettet</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 16, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Sist endret</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">December 16, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#import-og-testdata" id="toc-import-og-testdata" class="nav-link active" data-scroll-target="#import-og-testdata">Import og testdata</a></li>
  <li><a href="#grunnleggende-bruk---schema" id="toc-grunnleggende-bruk---schema" class="nav-link" data-scroll-target="#grunnleggende-bruk---schema">Grunnleggende bruk - schema</a></li>
  <li><a href="#behov-for-flere-kontroller" id="toc-behov-for-flere-kontroller" class="nav-link" data-scroll-target="#behov-for-flere-kontroller">Behov for flere kontroller</a></li>
  <li><a href="#bruk-av-validering-i-funksjonene" id="toc-bruk-av-validering-i-funksjonene" class="nav-link" data-scroll-target="#bruk-av-validering-i-funksjonene">Bruk av validering i funksjonene</a></li>
  <li><a href="#bonus-auto-transformasjon-av-kolonneverdier" id="toc-bonus-auto-transformasjon-av-kolonneverdier" class="nav-link" data-scroll-target="#bonus-auto-transformasjon-av-kolonneverdier">BONUS: Auto-transformasjon av kolonneverdier</a></li>
  <li><a href="#oppsummering" id="toc-oppsummering" class="nav-link" data-scroll-target="#oppsummering">Oppsummering</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/statisticsnorway/dapla-manual/edit/main/dapla-manual/blog/posts/2024-12-16-data-validering-pandera/index.qmd" class="toc-action"><i class="bi bi-github"></i>Rediger siden</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/issues/new" class="toc-action"><i class="bi empty"></i>Rapporter feil</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/blob/main/dapla-manual/blog/posts/2024-12-16-data-validering-pandera/index.qmd" class="toc-action"><i class="bi empty"></i>Vis kilde</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><a href="https://pandera.readthedocs.io/en/stable/index.html#">Pandera</a> er en python pakke og rammeverk for testing av data - altså <em>datavalidering</em>.</p>
<p>Begrepet testing kan føre til misforståelser mellom statistikkere og utviklere: en statistikker vil ofte tenke på testing av data, og utvikler på testing av kode. Sistnevnte omtales som enhetstesting.</p>
<p>Det finnes flere rammeverk for testing av kode og datavalidering. Når det kommer til Python bruker vi i SSB som oftest <a href="https://docs.pytest.org/en/stable/">Pytest</a> pakken for testing av kode, og Pandera eller <a href="https://docs.pydantic.dev/latest/">Pydantic</a> pakkene for datavalidering. Alle disse pakkene står oppført på <a href="https://statistics-norway.atlassian.net/wiki/spaces/Arkitektur/pages/3538355352/Godkjentliste+for+statistikkproduksjon+p+Dapla#Enhetstester,-objektmodeller-og-milj%C3%B8variabler">godkjentlista</a> i SSB.</p>
<p><strong>Pandera eller Pydantic?</strong> Hvem av dem som bør benyttes avhenger mest av strukturen på dataene din. Dersom dataene er semi-strukturert (ofte filformater som json og xml) så vil fort Pydantic være mest aktuell, mens er dataene strukturerte (som en dataframe, eller filformat som csv) så vil Pandera være ett mer naturlig valg. Her vil det gis en intro til Pandera. Vel og merke vil innholdet her dreie seg om grunnleggende bruk, samt forskjellige tips og triks i hvordan det kan brukes, og muligens en bonus til slutt. Mer avanserte temaer, som f.eks. hypotesetesting, er ikke med her.</p>
<p>Men <strong>hvorfor Pandera?</strong> Og hvorfor validere data? Siste er enkelt å besvare og ligger godt integrert i SSBs samfunnsansvar: Vi skal ha god kvalitet i all statistikk, forskning og analyse.</p>
<p>I den moderniseringsprosessen SSB er i, overgang til Dapla, er det naturlig at dette integreres i kodene våre. Det er en <a href="https://statistics-norway.atlassian.net/wiki/spaces/BEST/pages/3223420981/Trinnvis+arbeid#A-021-Anbefaling%3A-Kontroller-data-for-hvert-trinn.">anbefaling fra KVAKK</a> anbefaler også å kontrollere data for hvert trinn. Da er datavalideringspakker som Pandera høyst aktuell. I tillegg er det en <a href="https://statistics-norway.atlassian.net/wiki/spaces/BEST/pages/3041492993/Regler+og+anbefalinger+for+versjonskontroll+med+Git#A-011-Anbefaling:-Produksjonskode-skal-som-standard-v%C3%A6re-%C3%A5pen-kildekode.-Det-vil-si-at-git-repoene-skal-v%C3%A6re-public.">annen anbefaling fra KVAKK</a>, og en <a href="https://statistics-norway.atlassian.net/wiki/spaces/Arkitektur/pages/4248731934/ADR0006+-+Retningslinjer+for+pen+intern+og+lukket+kildekode+i+SSB">ADR vedtatt i SSB</a>, om at kildekode skal være offentlig tilgjengelig. En eller annen gang skal altså produksjonskoden vår bli offentlig tilgjengelig. Dette er kanskje mine personlige meninger rundt det, men jeg vil tro at det vil foreligge en stor forventning der ute om at SSB validerer data i kode. Selv om Pandera er relativt nytt støtter den de aller mest brukte dataframe-rammeverkene som er i bruk i SSB, slik som Pandas, Polars, og PySpark.</p>
<section id="import-og-testdata" class="level2">
<h2 class="anchored" data-anchor-id="import-og-testdata">Import og testdata</h2>
<p>Først importerer vi noen biblioteker som vi skal benytte. For å benytte Pandera pakken må det lastes inn til ett virtuelt miljø, som vi i SSB benytter <a href="../../../statistikkere/jobbe-med-kode.html#dapla-toolbelt">ssb-project</a> for;</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>terminal</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="terminal"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> add pandera</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Versjonen av Pandera som benyttes i introduksjonen her er <strong>0.20.4</strong>. Følgende pakker får jeg importert deretter;</p>
<div id="a4c8cdea" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uuid</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Dict</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandera <span class="im">as</span> pan</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandera.typing <span class="im">import</span> DataFrame, Series</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandera.errors <span class="im">import</span> SchemaErrors</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Jeg lager også følgende lekedata vi skal ta for oss i eksemplene;</p>
<div id="38ed5ea5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>random_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id_nr"</span>: [<span class="bu">str</span>(uuid.uuid4()) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(size)],</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lope_id_nr"</span>: [<span class="st">"L"</span> <span class="op">+</span> <span class="bu">str</span>(<span class="dv">1</span>).zfill(<span class="dv">4</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(size)],</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aar"</span>: np.random.choice([<span class="st">'2023'</span>, <span class="st">'2024'</span>], size),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"navn"</span>: np.random.choice([<span class="st">'Ola'</span>, <span class="st">'Kari'</span>, <span class="st">'Per'</span>, <span class="st">'Ida'</span>], size),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produkt"</span>: np.random.choice([<span class="st">'Eple'</span>, <span class="st">'Gulrot'</span>, <span class="st">'Brokkoli'</span>], size),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"salgsverdi"</span>: np.random.randint(<span class="dv">1000</span>, <span class="dv">10000</span>, size),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vekt"</span>: np.random.randint(<span class="dv">500</span>, <span class="dv">5000</span>, size)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>random_data[<span class="st">'kostverdi'</span>] <span class="op">=</span> (</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    random_data[<span class="st">'salgsverdi'</span>] <span class="op">*</span> <span class="fl">0.75</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>).astype(<span class="bu">int</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>bad_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id_nr"</span>: [<span class="st">"random-id1"</span>, <span class="st">"random-id1"</span>, <span class="st">"random-id2"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"random-id2"</span>, <span class="st">"random-id3"</span>],</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lope_id_nr"</span>: [<span class="st">"L0001"</span>, <span class="st">"L0002"</span>, <span class="st">"L0001"</span>, <span class="st">"L0001"</span>, <span class="st">"0001"</span>],</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aar"</span>: [<span class="st">'2023'</span>, <span class="st">'2023'</span>, <span class="st">'2024'</span>, <span class="st">'2024'</span>, <span class="st">'2024Q1'</span>],</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"navn"</span>: [<span class="st">'Ola'</span>, <span class="st">'Ola'</span>, <span class="st">'Per'</span>, <span class="st">'Kari'</span>, <span class="va">None</span>],</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"produkt"</span>: [<span class="st">'Banan'</span>, <span class="st">'Eple'</span>, <span class="st">'Eple'</span>, <span class="st">'Agurk'</span>, <span class="st">'Eple'</span>],</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"salgsverdi"</span>: [<span class="dv">5000</span>, <span class="dv">4000</span>, <span class="dv">7000</span>, <span class="dv">3000</span>, <span class="dv">50</span>],</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vekt"</span>: [<span class="dv">700</span>, <span class="dv">600</span>, <span class="dv">700</span>, <span class="dv">100</span>, <span class="dv">5</span>],</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kostverdi"</span>: [<span class="dv">3500</span>, <span class="dv">2500</span>, <span class="dv">5000</span>, <span class="dv">3100</span>, <span class="dv">55</span>],</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.concat([random_data, bad_data], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_nr</th>
<th data-quarto-table-cell-role="th">lope_id_nr</th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">navn</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
<th data-quarto-table-cell-role="th">vekt</th>
<th data-quarto-table-cell-role="th">kostverdi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9c2a0f28-830f-4ae3-9400-8d992bcaa4b4</td>
<td>L0001</td>
<td>2023</td>
<td>Per</td>
<td>Eple</td>
<td>9921</td>
<td>3698</td>
<td>7440</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>97a1e3cf-c465-49a9-9d58-28810ff5acd6</td>
<td>L0001</td>
<td>2023</td>
<td>Ola</td>
<td>Gulrot</td>
<td>8806</td>
<td>994</td>
<td>6604</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ce06b21d-c416-4a12-9180-71a36a891fb4</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Brokkoli</td>
<td>6387</td>
<td>4145</td>
<td>4790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>43903841-4231-4471-b9a5-c8947ca4c985</td>
<td>L0001</td>
<td>2023</td>
<td>Kari</td>
<td>Eple</td>
<td>2813</td>
<td>4778</td>
<td>2109</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>76cf98f9-9e6b-42a3-b1d7-d04816b7a1be</td>
<td>L0001</td>
<td>2023</td>
<td>Ida</td>
<td>Brokkoli</td>
<td>7053</td>
<td>3606</td>
<td>5289</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>f78f7396-2554-4f8a-a171-66682628b6db</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Eple</td>
<td>3221</td>
<td>2344</td>
<td>2415</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>random-id1</td>
<td>L0001</td>
<td>2023</td>
<td>Ola</td>
<td>Banan</td>
<td>5000</td>
<td>700</td>
<td>3500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>random-id1</td>
<td>L0002</td>
<td>2023</td>
<td>Ola</td>
<td>Eple</td>
<td>4000</td>
<td>600</td>
<td>2500</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>random-id2</td>
<td>L0001</td>
<td>2024</td>
<td>Per</td>
<td>Eple</td>
<td>7000</td>
<td>700</td>
<td>5000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>random-id2</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Agurk</td>
<td>3000</td>
<td>100</td>
<td>3100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>random-id3</td>
<td>0001</td>
<td>2024Q1</td>
<td>None</td>
<td>Eple</td>
<td>50</td>
<td>5</td>
<td>55</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Dataframen består av følgende kolonner:</p>
<ul>
<li><em>id_nr</em>: identifiseringsnummer</li>
<li><em>lope_nr_id</em>: et slags løpenummerid</li>
<li><em>aar</em>: perioden i år for gjeldende rad</li>
<li><em>navn</em>: navn på enheten (person eller kunde)</li>
<li><em>produkt</em>: produktet det gjelder - la oss si i en frukt og grønt butikk</li>
<li><em>salgsverdi</em>: sluttverdien varen ble solgt for</li>
<li><em>vekt</em>: sluttvekten som ble solgt</li>
<li><em>kostverdi</em>: kostnaden tilknyttet innkjøp av produktet eller varen.</li>
</ul>
<p>Det er elementer her som ikke nødvendigvis er fullt realistist med virkeligheten, men sammensetningen av disse kolonnene er mest bygd opp for å demonstrere mulighetene og fleksibiliteten ved bruk av pandera.</p>
</section>
<section id="grunnleggende-bruk---schema" class="level2">
<h2 class="anchored" data-anchor-id="grunnleggende-bruk---schema">Grunnleggende bruk - schema</h2>
<p>For å ta i bruk pandera må vi <strong>definere et schema</strong>. Schemaer definerer hvordan dataene forventes at skal se ut, spesielt når det kommer til datatyper.</p>
<p>Med pandera kan du validere både datatyper og innhold. Det er flere måter å definere ett schema på, men jeg kommer til å vise den anbefalte måten å gjøre det på. Den er ikke nødvendigvis den enkleste, men den er enkel nok, og har likheter til Pydantic.</p>
<p>Et schema i pandera defineres som følgende;</p>
<div id="7330eb6f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SchemaValidation1(pan.DataFrameModel):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    id_nr: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(unique<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    lope_id_nr: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        str_startswith<span class="op">=</span><span class="st">'L'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        str_length<span class="op">=</span>{<span class="st">'min_value'</span>: <span class="dv">5</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_value'</span>: <span class="dv">5</span>}</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    aar: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        str_length<span class="op">=</span>{<span class="st">'min_value'</span>: <span class="dv">4</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_value'</span>: <span class="dv">4</span>}</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    navn: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        nullable<span class="op">=</span><span class="va">False</span> <span class="co"># Default</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    produkt: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        isin<span class="op">=</span>[<span class="st">'Eple'</span>, <span class="st">'Banan'</span>, <span class="st">'Gulrot'</span>, <span class="st">'Brokkoli'</span>]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    salgsverdi: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(ge<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    vekt: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(ge<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    kostverdi: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(gt<span class="op">=</span><span class="dv">700</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Så <strong>hva er det vi har definert her?</strong></p>
<p>Vi har nå definert et eget Objekt, en class, kalt SchemaValidation1, som arver egenskapene til Pandera sitt objekt DataFrameModel. Mer avansert fra objekt og class verden trenger du ikke å gjøre eller kunne her egentlig, så ikke bli skremt med det første. Deretter definerer vi kolonnene som vi forventer i dette schemaet. Pandera er bygget på typing systemet til Python vel og merke, som enkelt forklart vil si at jeg kan bruke typing-pakkens objekter i definisjonen som han vil bruke til å validere for, men det gir også muligheten til å benytte pythons standardobjekter som str og int i definisjonen. Vi har også definert regler tilknyttet hver av disse kolonnene som da vil bli validert sammen med datatypene.</p>
<ul>
<li><em>id_nr</em> er en Serie (kolonner i pandas dataframe er av datatypen pandas serie) med forventet datatype string (str). Regler som er satt er at innholdet er unikt, altså ingen duplikater i de verdiene som ligger i kolonnen.</li>
<li><em>lope_id_nr</em> er også forventet datatype string. Den har 2 regler; at alle verdier starter med ‘L’, og at teksten er minimum og maksimum 5 karakterer lang.</li>
<li><em>aar</em> er forventet å være string, med regel om at den er 4 tegn lang.</li>
<li><em>navn</em> er forventet å være string, med regel om at det ikke skal være noen manglende verdier (missing values). Dette er standard for alle regler, så det er ikke nødvendig å notere, men for demonstrasjonens skyld så gjorde jeg det her.</li>
<li><em>produkt</em> er forventet å være string, med regler om at innholdet er blant verdiene i en gitt liste. I dette tilfellet Eple, Banan, Gulrot, Brokkoli. Kanskje er dette varene butikken selger og har i sortimentet sitt.</li>
<li><em>salgsverdi</em> er forventet å være en integer (int). Regel som er satt her er at verdiene er større eller lik 1000.</li>
<li><em>vekt</em> er forventet å være en integer. Regel som er satt her er at verdiene er større eller lik 500.</li>
<li><em>kostverdi</em> er forventet å være en integer. Regel som er satt her er at verdiene er større enn 700.</li>
</ul>
<p>Okei, da har vi definert schemaet. Vi skal bygge videre på dette snart. Det finnes mange flere innebygde valideringsregler enn de vi benytter her, og man må inn i dokumentasjonen til Pandera for å se om noe kan passe deg og ditt behov der, men her demonstrerer vi hvertfall noen som sikkert kommer til å bli brukt.</p>
<p>For å utføre valideringen gjør vi følgende;</p>
<div id="a012a2ae" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> SchemaValidation1.validate(data, lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> SchemaErrors <span class="im">as</span> error:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rapport av feil utslag i dataframe</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> error.failure_cases</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dataframe som ble sendt inn</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    errdata <span class="op">=</span> error.data</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Antall feil utslag</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    num_errors <span class="op">=</span> error.error_counts</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rapportmeilding av feil utslag i dict</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    error_message <span class="op">=</span> error.message</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>valresult</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">schema_context</th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">check</th>
<th data-quarto-table-cell-role="th">check_number</th>
<th data-quarto-table-cell-role="th">failure_case</th>
<th data-quarto-table-cell-role="th">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Column</td>
<td>id_nr</td>
<td>field_uniqueness</td>
<td>None</td>
<td>random-id1</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Column</td>
<td>id_nr</td>
<td>field_uniqueness</td>
<td>None</td>
<td>random-id1</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Column</td>
<td>id_nr</td>
<td>field_uniqueness</td>
<td>None</td>
<td>random-id2</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Column</td>
<td>id_nr</td>
<td>field_uniqueness</td>
<td>None</td>
<td>random-id2</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Column</td>
<td>lope_id_nr</td>
<td>str_length(5, 5)</td>
<td>0</td>
<td>0001</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Column</td>
<td>lope_id_nr</td>
<td>str_startswith('L')</td>
<td>1</td>
<td>0001</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Column</td>
<td>aar</td>
<td>str_length(4, 4)</td>
<td>0</td>
<td>2024Q1</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Column</td>
<td>navn</td>
<td>not_nullable</td>
<td>None</td>
<td>None</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Column</td>
<td>produkt</td>
<td>isin(['Eple', 'Banan', 'Gulrot', 'Brokkoli'])</td>
<td>0</td>
<td>Agurk</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Column</td>
<td>salgsverdi</td>
<td>greater_than_or_equal_to(1000)</td>
<td>0</td>
<td>50</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Column</td>
<td>vekt</td>
<td>greater_than_or_equal_to(500)</td>
<td>0</td>
<td>100</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Column</td>
<td>vekt</td>
<td>greater_than_or_equal_to(500)</td>
<td>0</td>
<td>5</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Column</td>
<td>kostverdi</td>
<td>greater_than(700)</td>
<td>0</td>
<td>55</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Objektet SchemaValidation1 har en metode validate som vi kan sende inn dataframen som skal valideres opp mot schemaet(som vi arvet fra pandera DataFrameModel objektet). Jeg har satt lazy til True her fordi jeg vil at han skal validere alt og ikke stoppe ved første feil han finner. Dersom valideringen feiler har pandera et error objekt SchemaErrors hvor flere nyttige rapporter blir lagd tilgjengelig for oss. Du kan selv legge med flere av dem, men her tar vi for oss dataframen med alle feilmeldingene som dukker opp. Dersom valideringen gikk bra vil du få dataframen du sendte inn i retur.</p>
<p>Rapporten vi har fått ut nå i dataframen valresult har vi flere utslag på. Kolonnen id_nr finnes det duplikater blant annet. Kolonnen lope_id_nr er det funnes en som har slått ut i begge definerte reglene som nevnt tidligere. osv, osv. Denne rapporten har vi kanskje et potensial for å utnytte videre? Men det får være opp til den enkelte.</p>
</section>
<section id="behov-for-flere-kontroller" class="level2">
<h2 class="anchored" data-anchor-id="behov-for-flere-kontroller">Behov for flere kontroller</h2>
<p>Dersom de innebygde mulighetene for validering ikke strekker til kan man definere reglene selv ved å definere egne metoder med tilhørende decorator (alfakrøll over metoden). Under her definerer jeg SchemaValidation2 som sett bort ifra de nye metodene er nesten helt identisk med SchemaValidation1. Forskjellen er at nå har kolonnen id_nr kun regelen om at den skal ikke ha manglende verdier i stedet for at det skal unike verdier.</p>
<div id="92ef0bad" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SchemaValidation2(pan.DataFrameModel):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    id_nr: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(nullable<span class="op">=</span><span class="va">False</span>) <span class="co"># Default</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    lope_id_nr: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        str_startswith<span class="op">=</span><span class="st">'L'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        str_length<span class="op">=</span>{<span class="st">'min_value'</span>: <span class="dv">5</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_value'</span>: <span class="dv">5</span>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    aar: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        str_length<span class="op">=</span>{<span class="st">'min_value'</span>: <span class="dv">4</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_value'</span>: <span class="dv">4</span>}</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    navn: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(nullable<span class="op">=</span><span class="va">False</span>) <span class="co"># Default</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    produkt: Series[<span class="bu">str</span>] <span class="op">=</span> pan.Field(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        isin<span class="op">=</span>[<span class="st">'Eple'</span>, <span class="st">'Banan'</span>, <span class="st">'Gulrot'</span>, <span class="st">'Brokkoli'</span>]</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    salgsverdi: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(ge<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    vekt: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(ge<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    kostverdi: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(gt<span class="op">=</span><span class="dv">700</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sjekke at kolonne aar er tekst med tall i seg</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.check</span>(<span class="st">"aar"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Valgfritt, men gir eget navn til regelen enn metodenavnet</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">"str_isdigits"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>               <span class="co"># Valgfritt, men her kan man styre feilmeldingen</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>               error<span class="op">=</span><span class="st">"str_not_digits"</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_isdigits(cls, s: Series[<span class="bu">str</span>]) <span class="op">-&gt;</span> Series[<span class="bu">bool</span>]:</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s.<span class="bu">str</span>.isdigit()</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># En metode kan sjekke flere kolonner,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># her sjekker vi både kostverdi og salgsverdi.</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validerer at Bananer har både høyere</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># salgsverdi og kostverdi enn Epler</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.check</span>(<span class="st">"kostverdi"</span>, <span class="st">"salgsverdi"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>               groupby<span class="op">=</span><span class="st">"produkt"</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>               name<span class="op">=</span><span class="st">"check_epler_bananer"</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> check_groupby(cls, grouped_value: Dict[<span class="bu">str</span>, Series[<span class="bu">int</span>]]) <span class="op">-&gt;</span> <span class="bu">bool</span>:</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> grouped_value[<span class="st">"Eple"</span>].<span class="bu">sum</span>() <span class="op">&lt;</span> grouped_value[<span class="st">"Banan"</span>].<span class="bu">sum</span>()</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Trenger du å sjekke mer enn bare en kolonne av gangen?</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># f.eks. at forholde mellom flere kolonner</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># har en bestemt regel å følge?</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Her sjekkes at kombinasjonen for kolonnene</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># id_nr og lope_id_nr er unike</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.dataframe_check</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> unique_combo_idnr_lopeidnr(cls, df: pd.DataFrame) <span class="op">-&gt;</span> Series[<span class="bu">bool</span>]:</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        df2 <span class="op">=</span> df.copy()</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        df3 <span class="op">=</span> (</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>            df2</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            .groupby([<span class="st">'id_nr'</span>, <span class="st">'lope_id_nr'</span>])</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            .agg({<span class="st">'aar'</span>: <span class="st">'count'</span>})</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>            .rename(columns<span class="op">=</span>{<span class="st">'aar'</span>: <span class="st">'duplikater'</span>}) <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        ).reset_index()</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        df2 <span class="op">=</span> df2.merge(df3,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>                        on<span class="op">=</span>[<span class="st">'id_nr'</span>, <span class="st">'lope_id_nr'</span>],</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>                        how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df2[<span class="st">'duplikater'</span>]</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Schemaet SchemaValidation2 har som vi ser nå 3 metoder;</p>
<ul>
<li><p>check_isdigits som sjekker at teksten faktisk kun inneholder tall. Her sjekkes kun kolonnen aar.</p></li>
<li><p>check_groupby som grupperer verdiene i kolonnen produkt. Det sjekkes her for kolonnene kostverdi og salgsverdi. Den sjekker at summen av bananer er høyere enn summen av epler (for å gjøre noe enkelt og irrelevant).</p></li>
<li><p>de 2 første sjekkene kan kun jobbe med en kolonne av gangen, ev. en groupby på en annen kolonne med fokus på de gjeldende kolonnene en har tenkt å sjekke for. Den tredje siste sjekken er litt annerledes, for de andre sjekkene har benyttet decoratoren check, mens den siste har dataframe_check. Dette vil si at hele dataframen sendes inn, og her vil du ha full fleksibilitet til å sjekke det du måtte ønske på tvers av alle kolonner. Viktigste er at det returneres en serie(kolonne) av boolske verdier (True/False). I denne siste sjekken unique_combo_idnr_lopeidnr sjekkes det at kombinasjonen av kolonnene id_nr og lope_id_nr er unike i dataframen.</p></li>
</ul>
<p>Igjen kan dataene valideres;</p>
<div id="ec1909c7" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> SchemaValidation2.validate(data, lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> SchemaErrors <span class="im">as</span> error:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> error.failure_cases</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>valresult</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">schema_context</th>
<th data-quarto-table-cell-role="th">column</th>
<th data-quarto-table-cell-role="th">check</th>
<th data-quarto-table-cell-role="th">check_number</th>
<th data-quarto-table-cell-role="th">failure_case</th>
<th data-quarto-table-cell-role="th">index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>DataFrameSchema</td>
<td>lope_id_nr</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>L0001</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>DataFrameSchema</td>
<td>lope_id_nr</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>L0001</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>DataFrameSchema</td>
<td>kostverdi</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>5000</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>DataFrameSchema</td>
<td>vekt</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>100</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>DataFrameSchema</td>
<td>vekt</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>700</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>DataFrameSchema</td>
<td>salgsverdi</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>3000</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>DataFrameSchema</td>
<td>salgsverdi</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>7000</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>DataFrameSchema</td>
<td>produkt</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>Agurk</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>DataFrameSchema</td>
<td>produkt</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>Eple</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>DataFrameSchema</td>
<td>navn</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>Kari</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>DataFrameSchema</td>
<td>navn</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>Per</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>DataFrameSchema</td>
<td>aar</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>2024</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>DataFrameSchema</td>
<td>aar</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>2024</td>
<td>8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>DataFrameSchema</td>
<td>kostverdi</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>3100</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>DataFrameSchema</td>
<td>id_nr</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>random-id2</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>DataFrameSchema</td>
<td>id_nr</td>
<td>unique_combo_idnr_lopeidnr</td>
<td>0</td>
<td>random-id2</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Column</td>
<td>lope_id_nr</td>
<td>str_startswith('L')</td>
<td>1</td>
<td>0001</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Column</td>
<td>kostverdi</td>
<td>check_epler_bananer</td>
<td>1</td>
<td>False</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Column</td>
<td>kostverdi</td>
<td>greater_than(700)</td>
<td>0</td>
<td>55</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Column</td>
<td>vekt</td>
<td>greater_than_or_equal_to(500)</td>
<td>0</td>
<td>5</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Column</td>
<td>vekt</td>
<td>greater_than_or_equal_to(500)</td>
<td>0</td>
<td>100</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Column</td>
<td>salgsverdi</td>
<td>check_epler_bananer</td>
<td>1</td>
<td>False</td>
<td>None</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Column</td>
<td>salgsverdi</td>
<td>greater_than_or_equal_to(1000)</td>
<td>0</td>
<td>50</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Column</td>
<td>produkt</td>
<td>isin(['Eple', 'Banan', 'Gulrot', 'Brokkoli'])</td>
<td>0</td>
<td>Agurk</td>
<td>9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Column</td>
<td>navn</td>
<td>not_nullable</td>
<td>None</td>
<td>None</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Column</td>
<td>aar</td>
<td>str_not_digits</td>
<td>1</td>
<td>2024Q1</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Column</td>
<td>aar</td>
<td>str_length(4, 4)</td>
<td>0</td>
<td>2024Q1</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>Column</td>
<td>lope_id_nr</td>
<td>str_length(5, 5)</td>
<td>0</td>
<td>0001</td>
<td>10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Desverre vil sjekker som gjelder hele dataframen registrere flere feil ettersom han sjekker alle kolonner for gjeldende rader. Derimot er fleksibiliteten ganske stor!</p>
</section>
<section id="bruk-av-validering-i-funksjonene" class="level2">
<h2 class="anchored" data-anchor-id="bruk-av-validering-i-funksjonene">Bruk av validering i funksjonene</h2>
<p>Over til et eksempel hvor pandera viser seg som veldig nyttig! La oss si at vi har klargjorte data klart, ihht. datatilstandene, og vi er da klare for å lage statistikkdata. Det er ikke gitt at løpet er helt rett fram mellom disse datatilstandene, men i dette eksempelet er jobben bare å få aggregert klargjorte data.</p>
<p>Nedenfor her lager jeg klargjorte data av de dataene som vi har jobbet med, og som er korrekte. Lager et tilhørende skjema, som bare arver fra det første schemaet vi lagde. Valideringen her vil selvsagt gå smertefritt igjennom.</p>
<div id="1ccff195" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>klargjort_df <span class="op">=</span> data.head(<span class="dv">6</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> KlargjortSchema(SchemaValidation1):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    klargjort_df <span class="op">=</span> KlargjortSchema.validate(klargjort_df, lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> SchemaErrors <span class="im">as</span> error:</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> error.failure_cases</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> error</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>klargjort_df</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_nr</th>
<th data-quarto-table-cell-role="th">lope_id_nr</th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">navn</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
<th data-quarto-table-cell-role="th">vekt</th>
<th data-quarto-table-cell-role="th">kostverdi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9c2a0f28-830f-4ae3-9400-8d992bcaa4b4</td>
<td>L0001</td>
<td>2023</td>
<td>Per</td>
<td>Eple</td>
<td>9921</td>
<td>3698</td>
<td>7440</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>97a1e3cf-c465-49a9-9d58-28810ff5acd6</td>
<td>L0001</td>
<td>2023</td>
<td>Ola</td>
<td>Gulrot</td>
<td>8806</td>
<td>994</td>
<td>6604</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ce06b21d-c416-4a12-9180-71a36a891fb4</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Brokkoli</td>
<td>6387</td>
<td>4145</td>
<td>4790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>43903841-4231-4471-b9a5-c8947ca4c985</td>
<td>L0001</td>
<td>2023</td>
<td>Kari</td>
<td>Eple</td>
<td>2813</td>
<td>4778</td>
<td>2109</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>76cf98f9-9e6b-42a3-b1d7-d04816b7a1be</td>
<td>L0001</td>
<td>2023</td>
<td>Ida</td>
<td>Brokkoli</td>
<td>7053</td>
<td>3606</td>
<td>5289</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>f78f7396-2554-4f8a-a171-66682628b6db</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Eple</td>
<td>3221</td>
<td>2344</td>
<td>2415</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Deretter definerer vi et eget schema for statistikkdata, med noen tilhørende regler og datatyper;</p>
<div id="6513f0bf" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StatistikkSchema(pan.DataFrameModel):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    aar: Series[pd.CategoricalDtype] <span class="op">=</span> pan.Field(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">coerce</span><span class="op">=</span><span class="va">True</span>, <span class="co"># Vil konvertere datatypene for meg</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        str_length<span class="op">=</span>{<span class="st">'min_value'</span>: <span class="dv">4</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'max_value'</span>: <span class="dv">4</span>})</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    produkt: Series[pd.CategoricalDtype] <span class="op">=</span> pan.Field(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">coerce</span><span class="op">=</span><span class="va">True</span>, <span class="co"># Vil konvertere datatypene for meg</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        isin<span class="op">=</span>[<span class="st">'Eple'</span>, <span class="st">'Banan'</span>, <span class="st">'Gulrot'</span>, <span class="st">'Brokkoli'</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    salgsverdi: Series[<span class="bu">int</span>] <span class="op">=</span> pan.Field(ge<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Så over til magien; <strong>Pandera schemaene kan innlemmes i hvilken som helst funksjon som har dataframes som input eller output</strong>, og det uten at du selv skriver at valideringen skal skje i funksjonen, det skjer automagisk! Og det gjøres som følgende;</p>
<div id="96a1b9f9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lazy for at valideringen skal utføres igjennom hele dataframene</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="at">@pan.check_types</span>(lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> agg_statistikk(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    df: DataFrame[KlargjortSchema]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> DataFrame[StatistikkSchema]:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    dff <span class="op">=</span> (</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        df</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        .copy()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">'aar'</span>, <span class="st">'produkt'</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        .agg({<span class="st">'salgsverdi'</span>: <span class="st">'sum'</span>})</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dff</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Så nå ved å bruke funksjonen, vil du ikke få lagd statistikkdata uten at både klargjorte data blir validert og godkjent, og at statistikkdata som er på vei ut av funksjonen er validert og godkjent. I vårt tilfelle skal det gå fint nå;</p>
<div id="ef319432" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>statistikk_df <span class="op">=</span> agg_statistikk(klargjort_df)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>statistikk_df</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2023</td>
<td>Brokkoli</td>
<td>7053</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023</td>
<td>Eple</td>
<td>12734</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023</td>
<td>Gulrot</td>
<td>8806</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2024</td>
<td>Brokkoli</td>
<td>6387</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2024</td>
<td>Eple</td>
<td>3221</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Man skal også kunne validere flere schemaer samtidig også hvis en ønsker det. Altså at input til funksjonen sjekkes opp mot flere schema samtidig, eller at output blir det. Det er ikke blitt demonstrert her.</p>
<p>Med det samme kan vi sjekke datatypene, vi hadde satt at Pandera skulle endre datatypene for oss. Både før og etter;</p>
<div id="677aedf4" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML, display</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>kdf <span class="op">=</span> pd.DataFrame(klargjort_df.dtypes, columns<span class="op">=</span>[<span class="st">'Datatyper'</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>sdf <span class="op">=</span> pd.DataFrame(statistikk_df.dtypes, columns<span class="op">=</span>[<span class="st">'Datatyper'</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Style dataframes</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>styled_df1 <span class="op">=</span> kdf.style.set_caption(<span class="st">"Klargjorte-data"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>styled_df2 <span class="op">=</span> sdf.style.set_caption(<span class="st">"Statistikk data"</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>display(HTML(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="ss">f"""</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;div style="display: flex; justify-content: space-around;"&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;div&gt;</span><span class="sc">{</span>styled_df1<span class="sc">.</span>to_html()<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;div&gt;</span><span class="sc">{</span>styled_df2<span class="sc">.</span>to_html()<span class="sc">}</span><span class="ss">&lt;/div&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="ss">&lt;/div&gt;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">

<div style="display: flex; justify-content: space-around;">
<div><style type="text/css">
</style>

<div id="T_dad52" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_dad52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabell&nbsp;1: Klargjorte-data
</figcaption>
<div aria-describedby="T_dad52-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_dad52" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_dad52_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Datatyper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_dad52_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">id_nr</td>
<td id="T_dad52_row0_col0" class="data row0 col0">object</td>
</tr>
<tr class="even">
<td id="T_dad52_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">lope_id_nr</td>
<td id="T_dad52_row1_col0" class="data row1 col0">object</td>
</tr>
<tr class="odd">
<td id="T_dad52_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">aar</td>
<td id="T_dad52_row2_col0" class="data row2 col0">object</td>
</tr>
<tr class="even">
<td id="T_dad52_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">navn</td>
<td id="T_dad52_row3_col0" class="data row3 col0">object</td>
</tr>
<tr class="odd">
<td id="T_dad52_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">produkt</td>
<td id="T_dad52_row4_col0" class="data row4 col0">object</td>
</tr>
<tr class="even">
<td id="T_dad52_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">salgsverdi</td>
<td id="T_dad52_row5_col0" class="data row5 col0">int64</td>
</tr>
<tr class="odd">
<td id="T_dad52_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">vekt</td>
<td id="T_dad52_row6_col0" class="data row6 col0">int64</td>
</tr>
<tr class="even">
<td id="T_dad52_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">kostverdi</td>
<td id="T_dad52_row7_col0" class="data row7 col0">int64</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>

</div>
<div><style type="text/css">
</style>

<div id="T_c8f7e" class="quarto-float quarto-figure quarto-figure-center anchored" data-quarto-postprocess="true">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="T_c8f7e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabell&nbsp;2: Statistikk data
</figcaption>
<div aria-describedby="T_c8f7e-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="T_c8f7e" class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_c8f7e_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Datatyper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_c8f7e_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">aar</td>
<td id="T_c8f7e_row0_col0" class="data row0 col0">category</td>
</tr>
<tr class="even">
<td id="T_c8f7e_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">produkt</td>
<td id="T_c8f7e_row1_col0" class="data row1 col0">category</td>
</tr>
<tr class="odd">
<td id="T_c8f7e_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">salgsverdi</td>
<td id="T_c8f7e_row2_col0" class="data row2 col0">int64</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>

</div>
</div>
</div>
</div>
</section>
<section id="bonus-auto-transformasjon-av-kolonneverdier" class="level2">
<h2 class="anchored" data-anchor-id="bonus-auto-transformasjon-av-kolonneverdier">BONUS: Auto-transformasjon av kolonneverdier</h2>
<p>Pandera har noe som kalles <em>parsers</em>, som gir oss muligheten til å utføre preprosesseringer på dataene før validering. Dette kan være flere typer transformasjoner som man bør sørge for er gjort før valideringen utføres, ev. om transformasjonen bare skal gjennomføres.</p>
<p>La oss ta et eksempel med en liten del av dataene vi har jobbet med til nå, da med data vi vet det ikke skal bli noe problemer med;</p>
<div id="a51b3fd0" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'dekningsbidrag'</span>] <span class="op">=</span> data[<span class="st">'salgsverdi'</span>] <span class="op">-</span> data[<span class="st">'kostverdi'</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> data.head(<span class="dv">3</span>).copy()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_nr</th>
<th data-quarto-table-cell-role="th">lope_id_nr</th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">navn</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
<th data-quarto-table-cell-role="th">vekt</th>
<th data-quarto-table-cell-role="th">kostverdi</th>
<th data-quarto-table-cell-role="th">dekningsbidrag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9c2a0f28-830f-4ae3-9400-8d992bcaa4b4</td>
<td>L0001</td>
<td>2023</td>
<td>Per</td>
<td>Eple</td>
<td>9921</td>
<td>3698</td>
<td>7440</td>
<td>2481</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>97a1e3cf-c465-49a9-9d58-28810ff5acd6</td>
<td>L0001</td>
<td>2023</td>
<td>Ola</td>
<td>Gulrot</td>
<td>8806</td>
<td>994</td>
<td>6604</td>
<td>2202</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ce06b21d-c416-4a12-9180-71a36a891fb4</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Brokkoli</td>
<td>6387</td>
<td>4145</td>
<td>4790</td>
<td>1597</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Jeg beregner her dekningsbidraget for hver observasjon, som da er differansen mellom salgsverdi og kostverdi. Det er mer eller mindre en funksjon som avhenger av disse to variablene, og må holdes oppdatert.</p>
<p>Og la oss nå si at kostverdien på første observasjonen ikke skulle være på 75 % av salgsverdi slik vi startet med, men av en eller annen grunn heller skulle være på 85 %. Vi kan editere det inn;</p>
<div id="8e32158f" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df.loc[<span class="dv">0</span>, [<span class="st">'kostverdi'</span>]] <span class="op">=</span> <span class="bu">int</span>(<span class="bu">round</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    df.iloc[<span class="dv">0</span>][<span class="st">'salgsverdi'</span>] <span class="op">*</span> <span class="fl">0.85</span>, <span class="dv">0</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_nr</th>
<th data-quarto-table-cell-role="th">lope_id_nr</th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">navn</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
<th data-quarto-table-cell-role="th">vekt</th>
<th data-quarto-table-cell-role="th">kostverdi</th>
<th data-quarto-table-cell-role="th">dekningsbidrag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9c2a0f28-830f-4ae3-9400-8d992bcaa4b4</td>
<td>L0001</td>
<td>2023</td>
<td>Per</td>
<td>Eple</td>
<td>9921</td>
<td>3698</td>
<td>8433</td>
<td>2481</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>97a1e3cf-c465-49a9-9d58-28810ff5acd6</td>
<td>L0001</td>
<td>2023</td>
<td>Ola</td>
<td>Gulrot</td>
<td>8806</td>
<td>994</td>
<td>6604</td>
<td>2202</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ce06b21d-c416-4a12-9180-71a36a891fb4</td>
<td>L0001</td>
<td>2024</td>
<td>Kari</td>
<td>Brokkoli</td>
<td>6387</td>
<td>4145</td>
<td>4790</td>
<td>1597</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Så nå har vi fått korrigert kostverdien på første observasjon, men dekningsbidraget er fortsatt den samme. Dette kan løses som en egen funksjon, men hvorfor ikke innlemme det i data valideringen vår, da pandera støtter slik transformering. Vi lager først et tilhørende schema;</p>
<div id="1b7117c7" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ParserSchema(SchemaValidation1):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    dekningsbidrag: Series[<span class="bu">int</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.check</span>(<span class="st">"navn"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_uppercase(cls, s: Series[<span class="bu">str</span>]) <span class="op">-&gt;</span> Series[<span class="bu">bool</span>]:</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s.<span class="bu">str</span>.isupper()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># konverterer all tekst i kolonnen til å ha kun store bokstaver</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.parser</span>(<span class="st">"navn"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> uppercase(cls, s: Series[<span class="bu">str</span>]) <span class="op">-&gt;</span> Series[<span class="bu">str</span>]:</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> s.<span class="bu">str</span>.upper()</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sørger for at dekningsbidrag blir rekalkulert</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">@pan.dataframe_parser</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> kalkuler_dekningsbidrag(cls, df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'dekningsbidrag'</span>] <span class="op">=</span> df[<span class="st">'salgsverdi'</span>] <span class="op">-</span> df[<span class="st">'kostverdi'</span>]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Så her tar jeg i bruk det aller første schema som vi definerte, men legger på dekningsbidrag som ikke har noen andre valideringer enn datatype. Med dataene vi har nå skal det ikke dukke opp noen feil med dette. Jeg legger ved en valideringsregel for navn i dette tilfelle, hvor nå alt i kolonnen navn skal være store bokstaver. Vi vet allerede at det ikke er noen store bokstaver der, så vi legger inn en metode som har decorator parser som vil transformere dette. I tillegg legger vi til en egen metode med decorator dataframe_parser for å rekalkulere dekningsbidraget.</p>
<p>Så sånn sett skulle man kanskje tro at valideringen av kolonnen navn vil kunne slå ut i valideringen, men som nevnt så kjøres transformasjonene først før valideringen. I tillegg, når valideringen går igjennom, vil du få dataframen du sendte inn i retur ved utførelsen av valideringen;</p>
<div id="acd06f70" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> ParserSchema.validate(df, lazy<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> SchemaErrors <span class="im">as</span> error:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    valresult <span class="op">=</span> error.failure_cases</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>valresult</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id_nr</th>
<th data-quarto-table-cell-role="th">lope_id_nr</th>
<th data-quarto-table-cell-role="th">aar</th>
<th data-quarto-table-cell-role="th">navn</th>
<th data-quarto-table-cell-role="th">produkt</th>
<th data-quarto-table-cell-role="th">salgsverdi</th>
<th data-quarto-table-cell-role="th">vekt</th>
<th data-quarto-table-cell-role="th">kostverdi</th>
<th data-quarto-table-cell-role="th">dekningsbidrag</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9c2a0f28-830f-4ae3-9400-8d992bcaa4b4</td>
<td>L0001</td>
<td>2023</td>
<td>PER</td>
<td>Eple</td>
<td>9921</td>
<td>3698</td>
<td>8433</td>
<td>1488</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>97a1e3cf-c465-49a9-9d58-28810ff5acd6</td>
<td>L0001</td>
<td>2023</td>
<td>OLA</td>
<td>Gulrot</td>
<td>8806</td>
<td>994</td>
<td>6604</td>
<td>2202</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>ce06b21d-c416-4a12-9180-71a36a891fb4</td>
<td>L0001</td>
<td>2024</td>
<td>KARI</td>
<td>Brokkoli</td>
<td>6387</td>
<td>4145</td>
<td>4790</td>
<td>1597</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Som vi nå ser har valideringen gått fint for seg. Vi ser at alle verdier i kolonnen navn har blitt tekst med kun store bokstaver, og vi ser at dekningsbidraget har blitt rekalkulert så det nå er korrekt!</p>
</section>
<section id="oppsummering" class="level2">
<h2 class="anchored" data-anchor-id="oppsummering">Oppsummering</h2>
<p>For at vi skal kunne produsere og levere statistikk av høy kvalitet er det viktig at vi validerer data løpende i produksjonsløpene våre. Store deler av dataene våre er strukturerte, ev. tidy om du vil, og da er python pakken Pandera en sterk kandidat å benytte inn i kodene våre. Hvertfall hvis du programmerer i Python. For R så er pakken <a href="https://github.com/data-cleaning/validate">Validate</a> aktuell. Her har vi introdusert generell bruk av Pandera for validering av data; hvordan definere schema og valideringsregler, hvordan validere en dataframe med det, og hvordan det kan tas i bruk i blant annet funksjoner. Trenger du hjelp til å implementere data validering med Pandera inn i koden din, så er Støtteteamene mulig å spørre, ellers kommer man ikke unna <a href="https://pandera.readthedocs.io/en/stable/index.html">dokumentasjonen til Pandera</a> selv.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/manual\.dapla\.ssb\.no");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This site is heavily inspired by the <a href="https://quarto.org/">Quarto website</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>Kom i gang med Dapla</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/statisticsnorway/dapla-manual/edit/main/dapla-manual/blog/posts/2024-12-16-data-validering-pandera/index.qmd" class="toc-action"><i class="bi bi-github"></i>Rediger siden</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/issues/new" class="toc-action"><i class="bi empty"></i>Rapporter feil</a></li><li><a href="https://github.com/statisticsnorway/dapla-manual/blob/main/dapla-manual/blog/posts/2024-12-16-data-validering-pandera/index.qmd" class="toc-action"><i class="bi empty"></i>Vis kilde</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>